sec <- ggplot(ceps,aes(futcfd,stdmat)) +
geom_boxplot(notch=T)
thd <- ggplot(ceps,aes(eduexp,stdmat)) +
geom_jitter(width=2,height=10,alpha=1/15)+
geom_smooth(method = "loess",span = 2)
library(easyGgplot2)
ggplot2.multiplot(fir,sec,thd,cols=3)
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepscleaned.csv")
ggplot(ceps,aes(eduexp,stdmat)) +
geom_jitter(width=2,height=10,alpha=1/15,size=0.8)+
geom_smooth(method = "loess",span = 2)+
theme_bw()+
labs(x='教育期望',y='数学标准分')
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(desc(pct)))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity', alpha=0.8) +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('skyblue','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(desc(pct)))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity', alpha=0.8) +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('skyblue','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity', alpha=0.8) +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('skyblue','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity', alpha=0.8) +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity',size=0.5) +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity',size=0.5) +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('grey','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct, fill=isna),
stat = 'identity',size=0.5,color='black') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
missing.values %>%
ggplot() +
geom_bar(aes(x = reorder(key,pct),
y = pct),
stat = 'identity',size=0.5,color='black') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='black') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='grey') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='grey') +
#scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='grey') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','red'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='grey') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','skyblue'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='grey') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','tomato'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "百分比")+
theme_bw()
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepsNA.csv")
missing.values <- ceps %>%
gather(key = "key", value = "val") %>%
mutate(isna = is.na(val)) %>%
group_by(key) %>%
mutate(total = n()) %>%
group_by(key, total, isna) %>%
summarise(num.isna = n()) %>%
mutate(pct = num.isna / total * 100)
levels <- (missing.values %>% filter(isna == T) %>% arrange(pct))$key
ggplot(missing.values) +
geom_bar(aes(x = reorder(key,pct),
y = pct,fill=isna),
stat = 'identity',size=0.5,color='grey') +
scale_x_discrete(limits = levels) +
scale_fill_manual(name = "",values = c('white','tomato'), labels = c("非缺失值", "缺失值")) +
coord_flip() +
labs(x ='变量', y = "%")+
theme_bw()
fir <- ggplot(cepsog)+
geom_density(aes(tr_mat))+
geom_density(aes(stdmat)) +
scale_fill_manual(name = "",values = c('white','tomato'), labels = c("非缺失值", "缺失值"))
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat))+
geom_density(aes(stdmat)) +
scale_fill_manual(name = "",values = c('white','tomato'), labels = c("非缺失值", "缺失值"))+
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),color='tomato')+
geom_density(aes(stdmat),color='skyblue') +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato')+
geom_density(aes(stdmat),fill='tomato',color='skyblue') +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato')+
geom_density(aes(stdmat),fill='skyblue',color='skyblue') +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato',alpha=1/2)+
geom_density(aes(stdmat),fill='skyblue',color='skyblue',alpha=1/2) +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato',alpha=1/5)+
geom_density(aes(stdmat),fill='skyblue',color='skyblue',alpha=1/5) +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato',alpha=1/9)+
geom_density(aes(stdmat),fill='skyblue',color='skyblue',alpha=1/95) +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato',alpha=0.7)+
geom_density(aes(stdmat),fill='skyblue',color='skyblue',alpha=0.7) +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(cepsog)+
geom_density(aes(tr_mat),fill='tomato',color='tomato',alpha=0.5)+
geom_density(aes(stdmat),fill='skyblue',color='skyblue',alpha=0.7) +
theme_bw()+
labs(x='数学成绩',y='密度')
ggplot(ceps,aes(futcfd,stdmat)) +
geom_boxplot(notch=T,outlier.colour ='skyblue',fill='skyblue')+
theme_bw()+
labs(x='对孩子未来的信心',y='数学标准分')
ceps$futcfd <- as.factor(ceps$futcfd)
ggplot(ceps,aes(futcfd,stdmat)) +
geom_boxplot(notch=T,outlier.colour ='skyblue',fill='skyblue')+
theme_bw()+
labs(x='对孩子未来的信心',y='数学标准分')
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepscleaned.csv")
set.seed(0427)
sample <- sample(1:nrow(ceps),600,replace = F)
cepssp <- ceps[sample,]
ggplot(ceps) +
geom_jitter(data=cepssp,width=2,height=10,alpha=1/15,size=0.8)+
geom_smooth(data=ceps,aes(eduexp,stdmat),method = "loess",span = 2)+
theme_bw()+
labs(x='教育期望',y='数学标准分')
ggplot(ceps) +
geom_jitter(data=cepssp,aes(eduexp,stdmat),width=2,height=10,alpha=1/15,size=0.8)+
geom_smooth(data=ceps,aes(eduexp,stdmat),method = "loess",span = 2)+
theme_bw()+
labs(x='教育期望',y='数学标准分')
ggplot(ceps) +
geom_jitter(data=cepssp,aes(eduexp,stdmat),width=2,height=10,alpha=1/2,size=0.8)+
geom_smooth(data=ceps,aes(eduexp,stdmat),method = "loess",span = 2)+
theme_bw()+
labs(x='教育期望',y='数学标准分')
?geom_smooth
?geom_boxplot
library(plotmo)
? plot_glmnet
install.packages('latex2exp')
library(latex2exp)
TeX('$\log (\lambda )$')
TeX('$\log(\lambda)$')
TeX('$\\alpha^\\beta$')
TeX('$\\log(\\lambda)$')
TeX('$\\alpha^\\beta$')
??plotmath
?plot_glmnet
?plot
plot(1, col.axis = "sky blue", col.lab = "thistle")
title("Main Title", sub = "sub title",
cex.main = 2,   font.main= 4, col.main= "blue",
cex.sub = 0.75, font.sub = 3, col.sub = "red")
plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))),mtext='自由度')
plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))))
plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))),mtext='自由度')
plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))),main='自由度')
#library(readr)
ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps_train.csv")
test <- read_csv("C:/Users/xsong/Desktop/table/ceps_test.csv")
x_test <- model.matrix(stdmat ~ grade9+sex+onechi+drunk+qurel+relation+desk+net+maedu+faedu+eduexp+dialect+chmwk+chcos+qianzi+futcfd+dial+chidia+eduyexp+huko+eduy+dangy+houspro+classtm+clpre+revitm+know+subject+drsmok+commhr+schcsrm+comno+buget+eduqua+teainc+schtype+fight+brkpb+smok+drink
,test)[,-1]
#schids+clsids+ids
y_test <- test %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
#write.csv(cepsresponse,file="C:/Users/xsong/Desktop/table/cepsresponse.csv",row.names = F)
#options(na.action="na.fail")
library(glmnet)
x_train <- model.matrix(stdmat ~ grade9+sex+onechi+drunk+qurel+relation+desk+net+maedu+faedu+eduexp+dialect+chmwk+chcos+qianzi+futcfd+dial+chidia+eduyexp+huko+eduy+dangy+houspro+classtm+clpre+revitm+know+subject+drsmok+commhr+schcsrm+comno+buget+eduqua+teainc+schtype+fight+brkpb+smok+drink
,ceps)[,-1]
#schids+clsids+ids
y_train <- ceps %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
cvfit <- cv.glmnet(x_train,y_train,type.measure='mse',alpha = 1)
best <- cvfit$lambda.min
lasso_mod <- glmnet(x_test,y_test,alpha = 1,lambda=best)
ridge_pred = predict(lasso_mod,s=best,newx=x_test)
mean((ridge_pred-y_test)^2)
#lasso.pred <- predict(lasso_mod,s=best ,newx=x[test ,])
lasso.coef <- predict(lasso_mod,type='coefficients',s=best)[1:55 ,]
#lasso.mse <- predict(lasso_mod,s=best)
library(latex2exp)
coeffin <- lasso.coef %>%
as.data.frame() %>%
rename('lasso.coef'='.') %>%
mutate(name=rownames(.)) %>%
filter(lasso.coef<20)
ggplot(coeffin,aes(reorder(name,lasso.coef),lasso.coef)) +
geom_segment(aes(x=reorder(name,lasso.coef), xend=reorder(name,lasso.coef), y=0, yend=lasso.coef),size=0.7) +
geom_point(size=2, color='red')+
coord_flip()+
labs(x='变量',y='LASSO回归系数') +
theme_bw()
library(plotmo)
lasso <- glmnet(x_train,y_train,alpha = 1)
shrink <- plot_glmnet(lasso,xvar='lambda',label=15,ylab='系数',xlab=expression(plain(log(lambda))),main='自由度')
plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))),main='自由度')
cc <- plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))),main='自由度')
cc
cc <- plot(cvfit,ylab='均方误差',xlab=expression(plain(log(lambda))),main='自由度')
cc
install.packages('tikzDevice')
library(tikzDevice)
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 3)))
as.character(as.expression(eq));
}
p1 <- p + geom_text(x = 25, y = 300, label = lm_eqn(df), parse = TRUE)
library(ggplot2)
df <- data.frame(x = c(1:100))
df$y <- 2 + 3 * df$x + rnorm(100, sd = 40)
p <- ggplot(data = df, aes(x = x, y = y)) +
geom_smooth(method = "lm", se=FALSE, color="black", formula = y ~ x) +
geom_point()
p
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 3)))
as.character(as.expression(eq));
}
p1 <- p + geom_text(x = 25, y = 300, label = lm_eqn(df), parse = TRUE)
p1
browseVignettes('xgboost')
library(mice)
?mice
setwd('F:\\Mysite\\Mysite')
blogdown:::serve_site()
blogdown:::stop_server()
ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps_train.csv")
test <- read_csv("C:/Users/xsong/Desktop/table/ceps_test.csv")
?v
?importance_lasso
??importance_lasso
library(glmnet)
?importance_lasso
library(mice)
?mice
ceps <- read_csv("C:/Users/xsong/Desktop/table/cepscleaned.csv")
summary(ceps$stdmat)
ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps_train.csv")
test <- read_csv("C:/Users/xsong/Desktop/table/ceps_test.csv")
ceps <- ceps %>% mutate(stdmat=replace(stdmat,stdmat>100,100),
stdmat=replace(stdmat,stdmat<40,40))
test <- test %>% mutate(stdmat=replace(stdmat,stdmat>100,100),
stdmat=replace(stdmat,stdmat<40,40))
summary(ceps$stdmat)
ggplot(ceps,aes(stdmat))+geom_density()
setwd('F:\\Mysite\\Mysite')
blogdown:::serve_site()
blogdown:::stop_server()
