stupat <- left_join(stu,parent,by="ids") %>%
left_join(.,class,by="clsids",copy=T, suffix = c("", " ")) %>%
stusch <- left_join(.,school,by="schids",copy=T)
stupat <- left_join(stu,parent,by="ids") %>%
left_join(.,class,by="clsids",copy=T, suffix = c("", " ")) %>%
left_join(.,school,by="schids",copy=T)
rm(list=ls())
stutestpre <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
stutestpre$ids <- stutestpre$ids %>% formatC(., width=5, flag="0", format="fg")
View(stutestpre)
stutestpre <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
stutestpre$ids <- stutestpre$ids %>% formatC(., width=5, flag="0", format="fg")
stutest <- stutestpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(w2mat,w2upmat)
View(stutest)
rm(list=ls())
stutestpre <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
stutestpre$ids <- stutestpre$ids %>% formatC(., width=5, flag="0", format="fg")
stutest <- stutestpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ids,w2mat,w2upmat)
ceps <- left_join(stu,parent,by="ids") %>%
left_join(.,class,by="clsids",copy=T, suffix = c("", " ")) %>%
left_join(.,school,by="schids",copy=T)
library(haven)
library(dplyr)
library(tidyr)
library(magrittr)
student <- read_dta("E:/edu/data/stu.dta")
student$ids <- student$ids %>% formatC(., width=5, flag="0", format="fg")
stu <- student %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ctyids,schids,clsids,ids,grade9,tr_chn,tr_mat,tr_eng,stdchn, stdmat,stdeng,a01,b01,b06,b07,b1001,b1002,b1003,b11,b13,b27,b2201,b2202, b31,sweight) %>%
mutate(sex=recode(a01,'1'= 'male', '2'='female'),
onechi=recode(b01,'1'='yes','2'='no'),
drunk=recode(b1001,'1'='no','2'='yes'),
qurel=recode(b1002,'1'='no','2'='yes'),
relation=recode(b1003,'1'= 'no', '2'='yes'),
desk=recode(b11,'1'='yes','2'='no'),
net=recode(b13,'0'='no','1'='no_net','2'='yes'),
maedu=recode(b06,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
faedu=recode(b07,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
eduexp=recode(b31,'1'=9,'2'=9,'3'=12,'4'=12,'5'=12,'6'=15,'7'=16,'8'=19,'9'=22,'10'=7),
dialect=recode(b27,'1'="madn",'2'='bt','3'='dia','4'='oth'),
chmwk=recode(b2201,'1'="no",'2'='1t2','3'='3t4','4'='evd'),
chcos=recode(b2202,'1'="no",'2'='1t2','3'='3t4','4'='evd')
)
#rm(list=ls())
stutestpre <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
stutestpre$ids <- stutestpre$ids %>% formatC(., width=5, flag="0", format="fg")
stutest <- stutestpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ids,w2mat,w2upmat)
classpre <- read_dta("E:/edu/data/class.dta")
student$ids <- student$ids %>% formatC(., width=5, flag="0", format="fg")
class <- classpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(clsids, schids,hrb06,hra07,hra08,hra09,hra01, hrb02, hrb08a, hrb08b) %>%
rename(classtm=hra07,clpre=hra08,revitm=hra09,know=hrb02) %>%
mutate(subject=recode(hra01,'0'='oth','1'='mat','2'='lit','3'='eng'),
drsmok=recode(hrb06,'1'='no','2'='yes','3'='yes','4'='yes'),
commhr=hrb08a+hrb08b/60,
know=as.factor(know)
)
schoolpre <- read_dta("E:/edu/data/school.dta")
school <- schoolpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(schids, pla01, pla13, pla16, pla17, pla18, plc0102, ple1101, ple1102, ple1103, ple1104, plc0601) %>%
rename(schcsrm=pla13,comno = pla16,buget = pla18,eduqua=plc0102,teainc=plc0601) %>%
mutate(schtype=recode(pla01,'1'='public','2'='oth','3'='oth','4'='oth'),
fight=recode(ple1101,'1'='no','3'='yes','4'='yes'),
brkpb=recode(ple1102,'1'='no','2'='yes','3'='yes','4'='yes'),
bknum=replace(pla17,pla17>40000,NA),
smok=recode(ple1103,'1'='no','2'='yes','3'='yes','4'='yes'),
drink=recode(ple1104,'1'='no','2'='yes','3'='yes'),
)
parentpre <- read_dta("E:/edu/data/parent.dta")
parentpre$ids <- parentpre$ids %>% formatC(., width=5, flag="0", format="fg")
parent <- parentpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ids,ba06,ba03, ba05, ba13, ba15, ba16, ba18, ba21, bd05, be07, be06, be24) %>%
mutate(qianzi=as.factor(ba05),
futcfd=as.factor(ba21),
dial=recode(ba15,'1'='madn','2'='bt','3'='dia','4'='oth'),
chidia=recode(ba16,'1'='madn','2'='bt','3'='dia','4'='oth'),
eduyexp=recode(ba18,'1'=9,'2'=9,'3'=12,'4'=12,'5'=12,'6'=15,'7'=16,'8'=19,'9'=22,'10'=7),
huko=recode(bd05,'1'='agr','2'='non','3'='oth','4'='oth'),
eduy=recode(be07,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
dangy=recode(be06,'1'='yes','2'='no','2'='no'),
houspro=recode(be24,'1'='yes','2'='no'),
lifetm=replace(ba13,ba13>15,NA),
clfee=replace(ba03,ba03>10000,NA),
money=replace(ba06,ba06>250,NA)
)
ceps <- left_join(stu,parent,by="ids") %>%
left_join(.,class,by="clsids",copy=T, suffix = c("", " ")) %>%
left_join(.,school,by="schids",copy=T)
cepstest <- left_join(ceps,stutest,by="ids")
View(cepstest)
summary(ceps$tr_mat)
table(ceps$tr_mat)
ggplot2::ggplot(ceps,aes(tr_mat))+
geom_hist()
ggplot2::ggplot(ceps,aes(tr_mat))+
geom_histogram()
library(ggplot2)
ggplot(ceps,aes(tr_mat))+
geom_histogram()
library(ggplot2)
ggplot(ceps,aes(tr_mat))+
geom_histogram(bins=500)
library(ggplot2)
ggplot(ceps,aes(tr_mat))+
geom_histogram(bins=50)
View(cepstest)
library(haven)
library(ggplot2)
library(dplyr)
library(pROC)
library(tidyr)
library(randomForest)
library(mice)
`%>%` <- magrittr::`%>%`
library(readr)
ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps.imputed.csv")
ceps <- ceps %>%
select(sdtotal,everything()) %>%
na.omit()
#options(na.action="na.fail")
library(glmnet)
x_train <- model.matrix(sdtotal ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation +  desk + net + dialect + chkhmwk + chkcouse + classtm + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm +  comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,ceps)[,-1]
y_train <- ceps %>%
select(sdtotal) %>%
unlist() %>%
as.numeric()
#cepsmat <- ceps %>%
# select(sex,onechi,maedu,faedu, drunk,qurel,relation,desk,net,dialect,chkhmwk, chkcouse , classtm,clpre,revitm,subject,know, drsmok,commhr,schtype,schcsrm,comno,bknum, buget,eduqua,fight,brkpb,smok,drink, teainc,money,clfee,qianzi,lifetm,dial,chidia,futcfd,huko,eduy,dangy,houspro) %>%
#  as.matrix() %>%
#  na.omit()
#sdtotal <- as.matrix(ceps$sdtotal)
lasso_mod <- glmnet(x_train,
y_train,
alpha = 1)
library(plotmo) # for plot_glmnet
plot_glmnet(lasso_mod,xvar='lambda',label=10)
#plot(lasso_mod,xvar="lambda",label=F,ylab='系数')
#lasso_mod
#cof <- coef(lasso_mod)
cvfit <- cv.glmnet(x_train,
y_train,
alpha = 1)
cvfit$lambda.min
cvfit$lambda.1se
#plot(cvfit)
student <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
library(haven)
library(dplyr)
library(tidyr)
library(magrittr)
student <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
student$ids <- student$ids %>% formatC(., width=5, flag="0", format="fg")
stu <- student %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ctyids,schids,clsids,ids,grade9,tr_chn,tr_mat,tr_eng,stdchn, stdmat,stdeng,a01,b01,b06,b07,b1001,b1002,b1003,b11,b13,b27,b2201,b2202, b31,sweight) %>%
mutate(sex=recode(a01,'1'= 'male', '2'='female'),
onechi=recode(b01,'1'='yes','2'='no'),
drunk=recode(b1001,'1'='no','2'='yes'),
qurel=recode(b1002,'1'='no','2'='yes'),
relation=recode(b1003,'1'= 'no', '2'='yes'),
desk=recode(b11,'1'='yes','2'='no'),
net=recode(b13,'0'='no','1'='no_net','2'='yes'),
maedu=recode(b06,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
faedu=recode(b07,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
eduexp=recode(b31,'1'=9,'2'=9,'3'=12,'4'=12,'5'=12,'6'=15,'7'=16,'8'=19,'9'=22,'10'=7),
dialect=recode(b27,'1'="madn",'2'='bt','3'='dia','4'='oth'),
chmwk=recode(b2201,'1'="no",'2'='1t2','3'='3t4','4'='evd'),
chcos=recode(b2202,'1'="no",'2'='1t2','3'='3t4','4'='evd')
)
student <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
student$ids <- student$ids %>% formatC(., width=5, flag="0", format="fg")
stu <- student %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ctyids,schids,clsids,ids,a01,b01,b06,b07,b1001,b1002,b1003,b11,b13,b27,b2201,b2202, b31,sweight) %>%
mutate(sex=recode(a01,'1'= 'male', '2'='female'),
onechi=recode(b01,'1'='yes','2'='no'),
drunk=recode(b1001,'1'='no','2'='yes'),
qurel=recode(b1002,'1'='no','2'='yes'),
relation=recode(b1003,'1'= 'no', '2'='yes'),
desk=recode(b11,'1'='yes','2'='no'),
net=recode(b13,'0'='no','1'='no_net','2'='yes'),
maedu=recode(b06,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
faedu=recode(b07,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
eduexp=recode(b31,'1'=9,'2'=9,'3'=12,'4'=12,'5'=12,'6'=15,'7'=16,'8'=19,'9'=22,'10'=7),
dialect=recode(b27,'1'="madn",'2'='bt','3'='dia','4'='oth'),
chmwk=recode(b2201,'1'="no",'2'='1t2','3'='3t4','4'='evd'),
chcos=recode(b2202,'1'="no",'2'='1t2','3'='3t4','4'='evd')
)
View(ceps)
ceps <- filter(ceps,grade9==0)
View(ceps)
ceps2 <- filter(ceps,tr_mat==75)
View(ceps2)
cepstest <- left_join(ceps,stutest,by="ids")
#rm(list=ls())
stutestpre <- read_dta("E:/data/CEPS/2014-2015/cepsw2studentEN.dta")
stutestpre$ids <- stutestpre$ids %>% formatC(., width=5, flag="0", format="fg")
stutest <- stutestpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ids,w2mat,w2upmat)
View(stutest)
table(w2upmat)
table(stutest$w2upmat)
library(haven)
library(dplyr)
library(tidyr)
library(magrittr)
rm(list=ls())
student <- read_dta("E:/data/CEPS/2013-2014/cepsw1studentEN.dta")
student$ids <- student$ids %>% formatC(., width=5, flag="0", format="fg")
stu <- student %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ctyids,schids,clsids,ids,grade9,tr_chn,tr_mat,tr_eng,stdchn, stdmat,stdeng,a01,b01,b06,b07,b1001,b1002,b1003,b11,b13,b27,b2201,b2202, b31,sweight) %>%
mutate(sex=recode(a01,'1'= 'male', '2'='female'),
onechi=recode(b01,'1'='yes','2'='no'),
drunk=recode(b1001,'1'='no','2'='yes'),
qurel=recode(b1002,'1'='no','2'='yes'),
relation=recode(b1003,'1'= 'no', '2'='yes'),
desk=recode(b11,'1'='yes','2'='no'),
net=recode(b13,'0'='no','1'='no_net','2'='yes'),
maedu=recode(b06,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
faedu=recode(b07,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
eduexp=recode(b31,'1'=9,'2'=9,'3'=12,'4'=12,'5'=12,'6'=15,'7'=16,'8'=19,'9'=22,'10'=7),
dialect=recode(b27,'1'="madn",'2'='bt','3'='dia','4'='oth'),
chmwk=recode(b2201,'1'="no",'2'='1t2','3'='3t4','4'='evd'),
chcos=recode(b2202,'1'="no",'2'='1t2','3'='3t4','4'='evd')
)
classpre <- read_dta("E:/data/CEPS/2013-2014/cepsw1teacherEN.dta")
student$ids <- student$ids %>% formatC(., width=5, flag="0", format="fg")
class <- classpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(clsids, schids,hrb06,hra07,hra08,hra09,hra01, hrb02, hrb08a, hrb08b) %>%
rename(classtm=hra07,clpre=hra08,revitm=hra09,know=hrb02) %>%
mutate(subject=recode(hra01,'0'='oth','1'='mat','2'='lit','3'='eng'),
drsmok=recode(hrb06,'1'='no','2'='yes','3'='yes','4'='yes'),
commhr=hrb08a+hrb08b/60,
know=as.factor(know)
)
schoolpre <- read_dta("E:/data/CEPS/2013-2014/cepsw1principalEN.dta")
school <- schoolpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(schids, pla01, pla13, pla16, pla17, pla18, plc0102, ple1101, ple1102, ple1103, ple1104, plc0601) %>%
rename(schcsrm=pla13,comno = pla16,buget = pla18,eduqua=plc0102,teainc=plc0601) %>%
mutate(schtype=recode(pla01,'1'='public','2'='oth','3'='oth','4'='oth'),
fight=recode(ple1101,'1'='no','3'='yes','4'='yes'),
brkpb=recode(ple1102,'1'='no','2'='yes','3'='yes','4'='yes'),
bknum=replace(pla17,pla17>40000,NA),
smok=recode(ple1103,'1'='no','2'='yes','3'='yes','4'='yes'),
drink=recode(ple1104,'1'='no','2'='yes','3'='yes'),
)
parentpre <- read_dta("E:/data/CEPS/2013-2014/cepsw1parentEN.dta")
parentpre$ids <- parentpre$ids %>% formatC(., width=5, flag="0", format="fg")
parent <- parentpre %>%
lapply(unclass) %>%
as.data.frame() %>%
select(ids,ba06,ba03, ba05, ba13, ba15, ba16, ba18, ba21, bd05, be07, be06, be24) %>%
mutate(qianzi=as.factor(ba05),
futcfd=as.factor(ba21),
dial=recode(ba15,'1'='madn','2'='bt','3'='dia','4'='oth'),
chidia=recode(ba16,'1'='madn','2'='bt','3'='dia','4'='oth'),
eduyexp=recode(ba18,'1'=9,'2'=9,'3'=12,'4'=12,'5'=12,'6'=15,'7'=16,'8'=19,'9'=22,'10'=7),
huko=recode(bd05,'1'='agr','2'='non','3'='oth','4'='oth'),
eduy=recode(be07,'1'=0,'2'=6,'3'=9,'4'=12,'5'=12,'6'=12,'7'=15,'8'=16,'9'=19),
dangy=recode(be06,'1'='yes','2'='no','2'='no'),
houspro=recode(be24,'1'='yes','2'='no'),
lifetm=replace(ba13,ba13>15,NA),
clfee=replace(ba03,ba03>10000,NA),
money=replace(ba06,ba06>250,NA)
)
ceps <- left_join(stu,parent,by="ids") %>%
left_join(.,class,by="clsids",copy=T, suffix = c("", " ")) %>%
left_join(.,school,by="schids",copy=T)
sampled <- ceps %>% sample(1:nrow(.),nrow(.)*0.25,replace=F)
sampled <- sample(1:nrow(ceps),nrow(ceps)*0.25,replace=F)
sampled <- sample(1:nrow(ceps),nrow(ceps)*0.25,replace=F)
test <- ceps[sampled,]
train <- ceps[-sampled,]
View(train)
#setwd("E:/edu/data2")
#ceps <- read_dta("E:/edu/data2/ceps.dta")
ceps1 <- ceps %>%
group_by(schids) %>%
summarize(mathmean = mean(sdmat, na.rm = T))
set.seed(2018)
sample <- sample(1:nrow(ceps1),30,replace = F)#随机抽取30个学校
ceps1 <- ceps1[sample,]
ceps1 <- ceps1$schids #提取抽中学校编号的向量
delte <- subset(ceps,schids == ceps1[1])
#遍历抽中的学校id，纵向合并数据框
for (i in ceps1) delte <- rbind(delte, subset(ceps,schids == i))
#箱线图
delte$schids <- as.factor(delte$schids)
ggplot(delte, aes(schids,tr_mat)) +
geom_boxplot(size=0.1,outlier.colour ='sky blue',fill='sky blue') +
xlab('学校代码') + ylab('数学原始成绩')+
theme_bw()
library(haven)
library(ggplot2)
library(dplyr)
library(rpart)
library(rpart.plot)
library(pROC)
library(tidyr)
library(randomForest)
library(mice)
`%>%` <- magrittr::`%>%`
#setwd("E:/edu/data2")
#ceps <- read_dta("E:/edu/data2/ceps.dta")
ceps1 <- ceps %>%
group_by(schids) %>%
summarize(mathmean = mean(sdmat, na.rm = T))
set.seed(2018)
sample <- sample(1:nrow(ceps1),30,replace = F)#随机抽取30个学校
ceps1 <- ceps1[sample,]
ceps1 <- ceps1$schids #提取抽中学校编号的向量
delte <- subset(ceps,schids == ceps1[1])
#遍历抽中的学校id，纵向合并数据框
for (i in ceps1) delte <- rbind(delte, subset(ceps,schids == i))
#箱线图
delte$schids <- as.factor(delte$schids)
ggplot(delte, aes(schids,tr_mat)) +
geom_boxplot(size=0.1,outlier.colour ='sky blue',fill='sky blue') +
xlab('学校代码') + ylab('数学原始成绩')+
theme_bw()
ceps1 <- ceps %>%
group_by(schids) %>%
summarize(mathmean = mean(sdmat, na.rm = T))
#setwd("E:/edu/data2")
#ceps <- read_dta("E:/edu/data2/ceps.dta")
ceps1 <- ceps %>%
group_by(schids) %>%
summarize(mathmean = mean(stdmat, na.rm = T))
set.seed(2018)
sample <- sample(1:nrow(ceps1),30,replace = F)#随机抽取30个学校
ceps1 <- ceps1[sample,]
ceps1 <- ceps1$schids #提取抽中学校编号的向量
delte <- subset(ceps,schids == ceps1[1])
#遍历抽中的学校id，纵向合并数据框
for (i in ceps1) delte <- rbind(delte, subset(ceps,schids == i))
#箱线图
delte$schids <- as.factor(delte$schids)
ggplot(delte, aes(schids,tr_mat)) +
geom_boxplot(size=0.1,outlier.colour ='sky blue',fill='sky blue') +
xlab('学校代码') + ylab('数学原始成绩')+
theme_bw()
#library(readr)
#ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps.imputed.csv")
ceps <- ceps %>%
select(sdtotal,everything()) %>%
na.omit()
#options(na.action="na.fail")
library(glmnet)
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chkhmwk + chkcouse + classtm + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm +comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
y_train <- train %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
#cepsmat <- ceps %>%
# select(sex,onechi,maedu,faedu, drunk,qurel,relation,desk,net,dialect,chkhmwk, chkcouse , classtm,clpre,revitm,subject,know, drsmok,commhr,schtype,schcsrm,comno,bknum, buget,eduqua,fight,brkpb,smok,drink, teainc,money,clfee,qianzi,lifetm,dial,chidia,futcfd,huko,eduy,dangy,houspro) %>%
#  as.matrix() %>%
#  na.omit()
#sdtotal <- as.matrix(ceps$sdtotal)
lasso_mod <- glmnet(x_train,
y_train,
alpha = 1)
library(plotmo) # for plot_glmnet
plot_glmnet(lasso_mod,xvar='lambda',label=10)
#plot(lasso_mod,xvar="lambda",label=F,ylab='系数')
#lasso_mod
#cof <- coef(lasso_mod)
cvfit <- cv.glmnet(x_train,
y_train,
alpha = 1)
cvfit$lambda.min
cvfit$lambda.1se
#library(readr)
#ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps.imputed.csv")
ceps <- ceps %>%
select(sdtotal,everything()) %>%
na.omit()
#options(na.action="na.fail")
library(glmnet)
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chkcouse + classtm + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm +comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
y_train <- train %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
#cepsmat <- ceps %>%
# select(sex,onechi,maedu,faedu, drunk,qurel,relation,desk,net,dialect,chkhmwk, chkcouse , classtm,clpre,revitm,subject,know, drsmok,commhr,schtype,schcsrm,comno,bknum, buget,eduqua,fight,brkpb,smok,drink, teainc,money,clfee,qianzi,lifetm,dial,chidia,futcfd,huko,eduy,dangy,houspro) %>%
#  as.matrix() %>%
#  na.omit()
#sdtotal <- as.matrix(ceps$sdtotal)
lasso_mod <- glmnet(x_train,
y_train,
alpha = 1)
library(plotmo) # for plot_glmnet
plot_glmnet(lasso_mod,xvar='lambda',label=10)
#plot(lasso_mod,xvar="lambda",label=F,ylab='系数')
#lasso_mod
#cof <- coef(lasso_mod)
cvfit <- cv.glmnet(x_train,
y_train,
alpha = 1)
cvfit$lambda.min
cvfit$lambda.1se
#library(readr)
#ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps.imputed.csv")
ceps <- ceps %>%
select(stdmat,everything()) %>%
na.omit()
#options(na.action="na.fail")
library(glmnet)
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chkcouse + classtm + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm +comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
y_train <- train %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
#cepsmat <- ceps %>%
# select(sex,onechi,maedu,faedu, drunk,qurel,relation,desk,net,dialect,chkhmwk, chkcouse , classtm,clpre,revitm,subject,know, drsmok,commhr,schtype,schcsrm,comno,bknum, buget,eduqua,fight,brkpb,smok,drink, teainc,money,clfee,qianzi,lifetm,dial,chidia,futcfd,huko,eduy,dangy,houspro) %>%
#  as.matrix() %>%
#  na.omit()
#sdtotal <- as.matrix(ceps$sdtotal)
lasso_mod <- glmnet(x_train,
y_train,
alpha = 1)
library(plotmo) # for plot_glmnet
plot_glmnet(lasso_mod,xvar='lambda',label=10)
#plot(lasso_mod,xvar="lambda",label=F,ylab='系数')
#lasso_mod
#cof <- coef(lasso_mod)
cvfit <- cv.glmnet(x_train,
y_train,
alpha = 1)
cvfit$lambda.min
cvfit$lambda.1se
#library(readr)
#ceps <- read_csv("C:/Users/xsong/Desktop/table/ceps.imputed.csv")
ceps <- ceps %>%
select(stdmat,everything()) %>%
na.omit()
#options(na.action="na.fail")
library(glmnet)
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos + classtm + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm +comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
y_train <- train %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
#cepsmat <- ceps %>%
# select(sex,onechi,maedu,faedu, drunk,qurel,relation,desk,net,dialect,chkhmwk, chkcouse , classtm,clpre,revitm,subject,know, drsmok,commhr,schtype,schcsrm,comno,bknum, buget,eduqua,fight,brkpb,smok,drink, teainc,money,clfee,qianzi,lifetm,dial,chidia,futcfd,huko,eduy,dangy,houspro) %>%
#  as.matrix() %>%
#  na.omit()
#sdtotal <- as.matrix(ceps$sdtotal)
lasso_mod <- glmnet(x_train,
y_train,
alpha = 1)
library(plotmo) # for plot_glmnet
plot_glmnet(lasso_mod,xvar='lambda',label=10)
#plot(lasso_mod,xvar="lambda",label=F,ylab='系数')
#lasso_mod
#cof <- coef(lasso_mod)
cvfit <- cv.glmnet(x_train,
y_train,
alpha = 1)
cvfit$lambda.min
cvfit$lambda.1se
y_train <- train %>%
select(stdmat) %>%
unlist() %>%
as.numeric()
library(glmnet)
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos + classtm + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm +comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
library(glmnet)
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos +chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos + clpre + revitm + subject + know + drsmok + commhr + schtype + schcsrm + comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos + classtm + clpre + revitm + subject + know + drsmok + commhr+ schcsrm + comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
x_train <- model.matrix(stdmat ~ schids + sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos+ subject + know + drsmok + commhr+ schcsrm + comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
?model.matrix
x_train <- model.matrix(stdmat ~ sex + onechi +  maedu +  faedu + drunk + qurel + relation + desk + net + dialect + chmwk + chcos + classtm + clpre + revitm + subject + know + drsmok + commhr+ schcsrm + comno +  bknum + buget + eduqua + fight + brkpb + smok +  drink +  teainc + money + clfee + qianzi + lifetm +  dial +  chidia +  futcfd +  huko + eduy +  dangy + houspro,train)[,-1]
str(train)
library(mlbench)
?mlbench
??mlbench
??BostonHousing
mlbench::BostonHousing
??mlbench::BostonHousing
?mlbench::BostonHousing
setwd('F:\\Mysite\\Mysite')
blogdown:::serve_site()
blogdown:::stop_server()
