abline(lm(y ~ x), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ x), col = "red")
plot(x, y, pch = 20, col = z)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ x), col = "red")
plot(x, y, pch = 20, col = z)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ z), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ z), col = "red")
plot(x, y, pch = 20, col = z)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(x ~ z), col = "red")
plot(x, y, pch = 20, col = z)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(x ~ z), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(z ~ x), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(z ~ y), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ z), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(x ~ z), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(x ~ y), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ x), col = "red")
plot(x, y, pch = 20, col = z)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ x), col = "red")
lm(y ~ z)
lm(y ~ x)
?lm
residuals(lm(y ~ z))
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ x), col = "red")
lm(y ~ z)
res <- residuals(lm(y ~ z))
abline(lm(res ~ x), col = "red")
lm(y ~ z)
res <- residuals(lm(y ~ z))
abline(lm(res ~ x), col = "red")
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
par(mar = c(4, 4, 0.1, 0.1))
plot(x, y)
abline(lm(y ~ x), col = "red")
lm(y ~ z)
res <- residuals(lm(y ~ z))
abline(lm(res ~ x), col = "red")
plot(x, res)
abline(lm(res ~ x), col = "red")
plot(x, y)
abline(lm(res ~ x), col = "red")
abline(lm(res ~ x), col = "red")
abline(lm(res ~ x), col = z)
abline(lm(res ~ x), group = z)
lm(res ~ x)
cc <- data.frame(x,y,z)
View(cc)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z))
library(ggplot2)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
moto <- data.frame(x,y,z)
ggplot(moto)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z))
library(ggplot2)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
z <- as.factor(z)
moto <- data.frame(x,y,z)
ggplot(moto)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z))
ggplot(moto, aes(x, y)) +
geom_line(lm)
ggplot(moto, aes(x, y)) +
geom_line(lm(y~x))
ggplot(moto, aes(x, y)) +
geom_line(lm(y ~ x))
ggplot(moto, aes(x, y)) +
geom_smooth(method='lm')
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm')
lm1 <- lm(y ~ z,moto)
res <- residuals(lm1)
ggplot(moto, aes(x,res)) +
geom_point(aes(color = z))
ggplot(moto, aes(x,res)) +
geom_smooth(method='lm')
ggplot(moto, aes(x,res)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm')
ggplot(moto, aes(x,res)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm',group=z)
ggplot(moto, aes(x,res)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm')
ggplot(moto, aes(x,res),group=z) +
geom_point(aes(color = z)) +
geom_smooth(method='lm')
ggplot(moto, aes(x,res),group=z) +
geom_point(aes(color = z)) +
geom_line()
res <- residuals(lm1)
ggplot(moto, aes(x,res),group=z) +
geom_point(aes(color = z))
ggplot(moto, aes(x,res),group=z) +
geom_point(aes(color = z))
ggplot(subset(moto,z==1), aes(x,res),group=z)
+
geom_smooth(method='lm')
ggplot(subset(moto,z==1), aes(x,res),group=z)+
geom_smooth(method='lm')
moto <- subset(moto,z==1)
library(ggplot2)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
z <- as.factor(z)
moto <- data.frame(x,y,z)
moto1 <- subset(moto,z==1)
ggplot(moto1, aes(x,res),group=z)+
geom_smooth(method='lm')
ggplot(moto1, aes(x,res))+
geom_smooth(method='lm')
View(moto1)
lm1 <- lm(y ~ z,moto)
res <- residuals(lm1)
ggplot(moto1, aes(x,res))+
geom_smooth(method='lm')
moto <- within(moto,res <- residuals(lm1))
View(cc)
View(moto)
moto1 <- subset(moto,z==1)
ggplot(moto1, aes(x,res))+
geom_smooth(method='lm')
geom_smooth(moto1, aes(x,res),method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_smooth(moto1, aes(x,res),method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_smooth(moto1,method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_smooth(moto1,method='lm')
ggplot(moto, aes(x,res),group=z)
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(moto1,method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm')
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z))
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm')+
geom_smooth(data = moto2,method='lm')
moto1 <- subset(moto,z==1)
moto2 <- subset(moto,z==2)
moto3 <- subset(moto,z==3)
moto4 <- subset(moto,z==4)
moto5 <- subset(moto,z==5)
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm')+
geom_smooth(data = moto2,method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm')+
geom_smooth(data = moto2,method='lm')+
geom_smooth(data = moto3,method='lm')+
geom_smooth(data = moto4,method='lm')+
geom_smooth(data = moto5,method='lm')
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F,color = z)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
ggplot(moto, aes(x,res),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
ggplot(moto, aes(x,res),group=z) +
geom_point(aes(color = z))
ggplot(moto, aes(x,y),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm')
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm',se=F)
ggplot(moto, aes(x,y),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
library(ggplot2)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
z <- as.factor(z)
moto <- data.frame(x,y,z)
lm1 <- lm(y ~ z,moto)
moto <- within(moto,res <- residuals(lm1))
moto1 <- subset(moto,z==1)
moto2 <- subset(moto,z==2)
moto3 <- subset(moto,z==3)
moto4 <- subset(moto,z==4)
moto5 <- subset(moto,z==5)
#ggplot(moto)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z))
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm',se=F)
ggplot(moto, aes(x,y),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
library(ggplot2)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
z <- as.factor(z)
moto <- data.frame(x,y,z)
lm1 <- lm(y ~ z,moto)
moto <- within(moto,res <- residuals(lm1))
moto1 <- subset(moto,z==1)
moto2 <- subset(moto,z==2)
moto3 <- subset(moto,z==3)
moto4 <- subset(moto,z==4)
moto5 <- subset(moto,z==5)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm',se=F)
library(ggplot2)
set.seed(711)
x = seq(0, 4, length = 100)
y = -x + jitter(rep(1:5, each = 20), 2)
z = rep(1:5, each = 20)
z <- as.factor(z)
moto <- data.frame(x,y,z)
lm1 <- lm(y ~ z,moto)
moto <- within(moto,res <- residuals(lm1))
moto1 <- subset(moto,z==1)
moto2 <- subset(moto,z==2)
moto3 <- subset(moto,z==3)
moto4 <- subset(moto,z==4)
moto5 <- subset(moto,z==5)
ggplot(moto, aes(x, y)) +
geom_point(aes(color = z)) +
geom_smooth(method='lm',se=F)
ggplot(moto, aes(x,y),group=z)+
geom_point(aes(color = z)) +
geom_smooth(data = moto1,method='lm',se=F)+
geom_smooth(data = moto2,method='lm',se=F)+
geom_smooth(data = moto3,method='lm',se=F)+
geom_smooth(data = moto4,method='lm',se=F)+
geom_smooth(data = moto5,method='lm',se=F)
cwg <- read_dta("C:/Users/xsong/Desktop/table/highdata/surv/cwg.dta")
# 加载包
library(survival)
library(haven)
library(ggplot2)
library(dplyr)
library(ggfortify)
cwg <- read_dta("C:/Users/xsong/Desktop/table/highdata/surv/cwg.dta")
#变量排序
cwg$event[cwg$cen_r ==0] <- 1
cwg$event[cwg$cen_r ==1] <- 0
cwg$los1 <- cwg$los1/30
cwg <- select(cwg,cen_r,event, los1,everything())
#head(cwg)#数据
View(cwg)
cwg$km
cwg$ec
cwg$black
cwg$female
cwg$age
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
# 加载包
library(survival)
library(haven)
library(ggplot2)
library(dplyr)
library(ggfortify)
cwg <- read_dta("C:/Users/xsong/Desktop/table/highdata/surv/cwg.dta")
#变量排序
cwg$event[cwg$cen_r ==0] <- 1
cwg$event[cwg$cen_r ==1] <- 0
cwg$los1 <- cwg$los1/30
cwg <- select(cwg,cen_r,event, los1,everything())
#head(cwg)#数据
table(cwg$event)
# Kaplan Meier Survival Curve
km <- with(cwg, Surv(los1, event == 1))
head(km,10) #删截后面有+号
km_fit <- survfit(km ~ 1, data=cwg)
km_fit #生存分析概要
knitr::include_graphics("/img/survival/life.jpg")
summary(km_fit, times = c(0.2*(1:25))) #这个表和生命表等价
knitr::include_graphics("/img/survival/life2.jpg")
autoplot(km_fit) #ggplot2风格KM图
km_trt_fit <- survfit(km ~ female, data=cwg)#分性别KM估计
autoplot(km_trt_fit) #图中+号可能是"打结" ties?
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
aaregfit <-aareg(km ~ ec + age + female +black + minc, data = cwg)
aaregfit
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
cox_fit <- survfit(coxreg)
#plot(cox_fit, main = "cph model", xlab="Days")
autoplot(cox_fit) #拟合值
survConcordance(coxreg)
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
cox_fit <- survfit(coxreg)
#plot(cox_fit, main = "cph model", xlab="Days")
autoplot(cox_fit) #拟合值
survConcordance(cox_fit)
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
cox_fit <- survfit(coxreg)
#plot(cox_fit, main = "cph model", xlab="Days")
autoplot(cox_fit) #拟合值
survConcordance(km ~ ec + age + female +black + minc, data = cwg)
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
cox_fit <- survfit(coxreg)
#plot(cox_fit, main = "cph model", xlab="Days")
autoplot(cox_fit) #拟合值
survConcordance(coxreg)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
survConcordance(coxph(km ~ age + female +black + minc, data = cwg))
survConcordance(Surv(los1, event == 1) ~ predict(coxreg), data = cwg))
survConcordance(km ~ predict(coxreg), data = cwg))
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
cox_fit <- survfit(coxreg)
#plot(cox_fit, main = "cph model", xlab="Days")
autoplot(cox_fit) #拟合值
survConcordance(km ~ predict(coxreg), data = cwg))
cwg$ec <- as.factor(cwg$ec)
cwg$minc <- as.factor(cwg$minc)
cwg$age <- as.factor(cwg$age)
coxreg <- coxph(km ~ ec + age + female +black + minc, data = cwg)
summary(coxreg)
cox_fit <- survfit(coxreg)
#plot(cox_fit, main = "cph model", xlab="Days")
autoplot(cox_fit) #拟合值
survConcordance(km ~ predict(coxreg), data = cwg))
survConcordance(km ~ predict(coxreg), data = cwg)
concordance(km ~ predict(coxreg), data = cwg)
setwd('F:\\Mysite\\Mysite')
blogdown:::serve_site()
m1 <- matrix(1:12,nrow=3,ncol=4)
m1
mode(m1)
type(m1)
attributes(m1)
class(m1)
m2 <- table(1:12,nrow=3,ncol=4)
m2
m2 <- table(1:12,nrow=3,ncol=3)
m2
m2 <- table(1:12)
m2
m2
class(m2)
y<-c('F','M','F','M','T','F')
z<-c(T,F,F,F,T)
m2 <- table(y,z)
y<-c('F','M','F','M','T','F')
z<-c(T,F,F,F,T)
m2 <- table(y,z,nrow=2,ncol=5)
m2
class(m2)
