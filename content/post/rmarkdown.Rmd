---
title: "使用RStudio写作"
author: " "
date: '2019-06-08'
slug: rmarkdown
---

+ 一些对理解本文有用的链接

谢益辉: [Sweave：打造一个可重复的统计研究流程](https://cosx.org/2010/11/reproducible-research-in-statistics)

[knitr 与可重复的统计研究（花絮篇）](https://cosx.org/2012/06/reproducible-research-with-knitr/)

[knitr中文介绍](https://bookdown.org/yihui/r-ninja/auto-report.html)

[knitr选项函数](https://yihui.name/knitr/options)

[R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)

宋春林：[用LaTeX写学位论文](http://songchunlin.net/cn/2019/03/latex-vs-word/)

[用 knitr 写作业](http://songchunlin.net/cn/2014/03/use-knitr/)

[在R Markdown文档中使用中文](https://www.jianshu.com/p/25356b414042)

---

我一开始使用$\rm{\LaTeX}$ 写论文。我一直以来用的是[MikTeX](https://miktex.org/)。

而之所以不使用[TeXmaker](http://www.xm1math.net/texmaker/)或是[CTeX](http://www.ctex.org/HomePage)是因为它们容易出Bug而且不简约（主要是因为懒得花时间学）。个人认为MikTeX是最轻量级的TeX了。然而，MikTeX的界面过于简单粗暴，并且无法更换背景颜色（我喜欢使用深色界面保护视力，但MikTeX无法修改）。

```{r,echo=F,out.width = '60%',fig.align='center',fig.cap='MikTeX界面'}
knitr::include_graphics("/img/sweave/mmk.jpg")

```

然而，RStudio的界面漂亮简单。也可以选择保护视力的深色主题。况且作为R用户，将写作、制作幻灯片、统计分析等工作整合到RStudio也大大提升了工作效率。如何做到这一点呢？

首先要安装$\rm{\LaTeX}$ 环境。安装后R会自动识别这个环境。Windows用户请注意，**MikTeX一定要安装在全英文路径下！** **MikTeX一定要安装在全英文路径下！** **MikTeX一定要安装在全英文路径下！**

后续需要安装一些R包，如`Knitr`，`tinytex`等（具体的R包我就不列出了，如果你没有安装，R会提示你的）。

然后需要配置一下RStudio的环境:

```{r, echo=F, out.width = '60%',fig.align='center',fig.cap='依次点击Tools - Global Options - Sweave配置Sweave环境'}
knitr::include_graphics("/img/sweave/tempsnip.png")
```

其中，`R Sweave Rnw files using`选`knitr`。想要写中文$\rm{\LaTeX}$ 文档必须选`XeLaTeX`环境。

我们点击`Open File`打开一个$\rm{\LaTeX}$ 文档：

```{r, echo=F, out.width = '70%',fig.align='center',fig.cap='点击Open File打开一个LaTeX文档'}
knitr::include_graphics("/img/sweave/cut.JPG")
```

打开后，可以直接在RStudio中进行编辑写作。完成后，点击上方`Complie PDF`编译$\rm{\LaTeX}$ 文档，如图：

```{r, echo=F, out.width = '70%',fig.align='center',fig.cap='点击Complie PDF编译LaTeX文档'}
knitr::include_graphics("/img/sweave/tempsnip2.png")
```


编译成功的PDF文档（是我用于某课程pre的[$\rm{\LaTeX}$ Beamer](http://deic.uab.es/~iblanes/beamer_gallery/index_by_theme.html)）如图：

```{r, echo=F, out.width = '70%',fig.align='center',fig.cap='编译好的PDF文档'}
knitr::include_graphics("/img/sweave/beamer.jpg")
```

编辑公式我使用[Mathtype](http://www.mathtype.cn/)或者这个[在线工具](http://www.wiris.com/editor/demo/en/developers)。Mathtype的好处在于可以直接将公式复制为$\rm{\LaTeX}$ 代码(需要事先设置好`剪切和复制预置`选项)：


```{r, echo=F, out.width = '80%',fig.align='center',fig.cap='Mathtype编辑器'}
knitr::include_graphics("/img/sweave/mathtype.jpg")
```

以上的公式可以直接复制为如下的纯文本$\rm{\LaTeX}$ 公式：

```
$$\ln {h_i}(t) = \ln {h_0}(t) + {\beta _1}{X_1} + {\beta _2}{X_2} +  \cdot  \cdot  \cdot  + {\beta _p}{X_p}$$
```
效果是这样的：

$$\ln {h_i}(t) = \ln {h_0}(t) + {\beta _1}{X_1} + {\beta _2}{X_2} +  \cdot  \cdot  \cdot  + {\beta _p}{X_p}$$

---

## 使用R Sweave

另一个方案是使用[R Sweave](https://cosx.org/2010/11/reproducible-research-in-statistics)。


R Sweave的主要功能并不是一个写纯$\rm{\LaTeX}$ 文档，而是为了将R代码嵌入$\rm{\LaTeX}$ 形成动态PDF报告。当然，作为日常工作，使用R Sweave写文档而不运行代码是完全可以的(只不过有点大材小用)。

方法很简单，新建一个R Sweave文档，然后在里面编辑$\rm{\LaTeX}$ ，之后运行就可以了。

```{r, echo=F, out.width = '25%',fig.align='center',fig.cap='新建一个R Sweave文档'}
knitr::include_graphics("/img/sweave/rnw.png")
```

注意，如果发现你编写的R Sweave文档的图片不能显示中文，可以在R代码块中加入如下语句：

```{r, eval=F}
pdf.options(family='GB1')
```



具体的关于R Sweave中文显示问题可以参看谢益辉老师的[这个链接](https://yihui.name/cn/2010/02/misc-issues-in-latex-lyx-r-sweave-pgfsweave/)。

R Sweave文档以.Rnw为后缀，它可以将R代码整合到$\rm{\LaTeX}$ 中去。当然，因为语法的复杂性，R Sweave的功能很大程度上被[R Markdown](https://rmarkdown.rstudio.com/)代替了。所以除非你有写论文的需求，否则尽量少用Sweave。

## R Markdown

此小节写在我最初写这篇文章的半年后。我现在认为用$\rm{\LaTeX}$ 、R Sweave之类的已经完全没有使用的必要了。如果你需要做幻灯片、写论文、做数据分析、做网页，答案只有一个：R Markdown！它的功能目前已经完全替代了前两者。需要注意的是，如果要输出PDF文档的话，最好使用`rticles`包附带的中文模板。具体可以看[这篇文章](https://www.jianshu.com/p/25356b414042)。

需要的注意的是，如果在使用R Markdown的`svg`图片格式进行输出(PDF 同样)，中文无法显示时。可以`install.packages('showtext')`后使用如下的`knitr`选项：

```{r, eval=F}
{r,dev='svg',fig.showtext=T}
```

矢量图输出人人有责。

## 表格工具

R Markdown同时支持HTML、Markdown、$\rm{\LaTeX}$ 表格。具体使用什么表格取决于要输出的格式。其中，HTML、$\rm{\LaTeX}$ 表格的语法十分复杂。我会使用[Tables Generator](https://www.tablesgenerator.com/)这个强大的工具生成表格。谁用谁知道！
