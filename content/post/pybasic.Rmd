---
title: 'Python小抄'
author: 
date: '2019-09-11'
categories: Python
slug: pybasic
---

下面是我积累的Python 实用小技巧。会根据经验增长持续更新，给自己也给可能需要的人做个备份。


# 从文件中读取数据

文件类提供了三种方法读取文本文件的内容，分别是：

```python
f.read(size)
```

返回一个字符串，内容为长度为size的文本。参数size可以省略。如果省略size参数，则表示**读取文件所有内容，作为一个字符串返回**。
```python
f.readline()
```

返回一个字符串，内容为文件当前一行的文本。

```python
f.readlines()
```
返回一个列表，列表的数据项为一行的文本[linel, line2, ···,lineN] 。再通过循环操作可以逐行访问列表中每一行的内容。

<center>
<table style="border-collapse:collapse;border-spacing:0" class="tg"><tr><th style="font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:top">mode </th><th style="font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:center;vertical-align:top">解释</th></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">r </td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">以只读方式打开</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">w</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">以写方式打开一个文件，当这个文件存在时，覆盖原来的内容。当这个文件不存在时，创建这个文件</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">x</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">创建一个新文件，以写方式打开，当文件已存在， 报错FileExistsError</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">a </td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">以写方式打开，写人内容追加在文件的末尾</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">b </td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">表示二进制文件，添加在其他控制字符后</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">t</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">表示文本文件，默认值</td></tr><tr><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">+</td><td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:inherit;text-align:left;vertical-align:top">以修改方式打开，支持读写</td></tr></table>
</center>

# 设置工作目录

+ 获取当前工作目录：
```python
import os
os.getcwd()    
```
+ 设置工作目录

```python
os.chdir(' ') 
```

# 设置`Jupyter Notebook`图片输出格式

[Jupyter Notebook魔术命令](http://blog.rexking6.top/2019/11/20/7%E4%B8%AAPython%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/)
+ SVG格式

+ Jupyter Notebook魔术命令

```python
%matplotlib inline
%config InlineBackend.figure_format = 'svg'
```
# 让图片说中文

```python
import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif']=['SimHei']
plt.rcParams['axes.unicode_minus']=False
```
# Jupyter Notebook 更换主题背景

长时间编程会导致眼睛疲劳，深色编程背景不可或缺，下面的代码提供了Jupyter Notebook 的深色主题。直接在Anaconda Prompt中输入就好：

```
jt -t monokai -f roboto -nf robotosans -tf robotosans -N -T -cellw 70% -dfs 10 -ofs 10
```
下面的主题更适合输出成网页：

```
jt -t grade3
```

# Anaconda 或Python 从本地离线安装第三方包

很多时候使用`conda install` 或`pip install` 都无法安装包。只好使用本地安装的方法去安装Github开发版。这很像R语言的`devtools::install_local`函数。下面是具体的做法。

首先确保已将Python添加入环境变量。由于我的电脑上使用的Anaconda而不是Python，我添加的是对应的Anaconda3文件夹(包含python.exe的文件夹)



1. 首先从github上clone或者直接下载zip文件并解压到目录A。

2. 目录A下有setup等文件：

![](https://img-blog.csdnimg.cn/20190124095012527.png)

3. 如果是windows系统，在目录A下，在未选择任何文件的情况下(可以先左键单击空白处)按住Shift的同时在空白处单击右键，调出菜单。此时点击【在此处打开命令窗口】的选项。

4. 在弹出的命令窗口中输入：

```
python setup.py install
```
5. 安装完成!

如果同时安装了Anaconda 和Python可能会出问题。因为Anaconda 自带了一个Python。如果只在一个路径中安装的话另一个仍是没有安装的。

# 在RStudio中运行Python

Python和R都是数据科学的必备工具。熟悉R的人都知道，R Studio是一款非常出色的R语言IDE。但一直以来，Python和R都是割裂的。[`reticulate`](https://rstudio.github.io/reticulate/)包能够为我们提供一些Python的调用功能。包括两个语言中对象的相互转化。

其中，`reticulate::repl_python()`能够实现在R Studio Console中运行Python代码。但是目前这个函数无法显示Python运行出的图片。如果想退出Python环境回到R，则输入`exit`。

其次，`reticulate`还能够支持Python代码[在R Markdown中的编译](https://rstudio.github.io/reticulate/#python-in-r-markdown)。这个功能目前似乎还不够完善，至少在我的电脑上，很多时候无法成功编译。

目前[谢益辉](https://yihui.org/cn/2019/07/hidden-gem/#comment-4698181689)的`xfun`包的[`convert_ipynb`函数](https://rmarkdown.rstudio.com/docs/reference/convert_ipynb.html)可以将后缀为.ipynb的文件完美转化为.Rmd文件，用法如下：

```r
nb_rmd = rmarkdown:::convert_ipynb(nb_file)
xfun::file_string(nb_rmd)
rmarkdown:::convert_ipynb("XXX.ipynb",
                          output = "YYY.Rmd")
```

如果`reticulate`有一天功能足够完善，可以用它支持的`knitr`编译，从而替代不能控制输出格式的Jupyter Notebook。那么R Studio也能成为一款非常出色的Python IDE。






