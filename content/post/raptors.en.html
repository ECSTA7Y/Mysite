---
title: '2018-2019 NBA Champion Toronto Raptors Analysis'
author: ''
date: '2019-10-30'
output:
  bookdown::html_document2:
    toc: true
    theme: readable
slug: raptors
---



<p>A Kaggle version is <a href="https://www.kaggle.com/rikdifos/2018-2019-nba-champion-toronto-raptors-analysis">here</a></p>
<p><img src="https://img.shields.io/badge/License-CC%20BY--NC--ND%204.0-brightgreen.svg" /></p>
<p>Toronto Raptors won the 2018-2019 NBA Championship, which is really exciting. I watched the playoffs even months after the season was over. As a data analyst, I found <a href="https://stats.nba.com/">datas</a> of Raptors and did this analysis. Since tree methods could apperantly display the relations between the feature variables and the response variable, it is appropriate to use them to reveal the factors of wining.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="/img/vignette/raptors.jpg" alt="Kawhi Leonard versus KD, who was injured during G5" width="100%" />
<p class="caption">
Figure 1: Kawhi Leonard versus KD, who was injured during G5
</p>
</div>
<pre class="r"><code>library(readr)
library(dplyr)
library(tidyr)
library(magrittr)
library(party)
library(rpart)
library(rpart.plot)
library(ggplot2)
library(corrplot)</code></pre>
<p>In order to explore effect of every player to games’ result, the data has been transformed to wide format, which every column represents a player’s statistic, including points, mins per game and field goals points etc. Moreover, I do not want to conclude unnecessary noise in datasets because some substitute players actually contribute very little. I remove those rows too.</p>
<pre class="r"><code>players &lt;- regular_players %&gt;% 
  na_if(&#39;-&#39;) %&gt;%
  filter(PLAYER!=&#39;Jodie Meeks&#39;,PLAYER!= &#39;Eric Moreland&#39;,
         PLAYER!=&#39;Jonas Valanciunas&#39;,PLAYER!=&#39;Jordan Loyd&#39;,
         PLAYER!=&#39;Malcolm Miller&#39;,PLAYER!=&#39;Chris Boucher&#39;,
         PLAYER!=&#39;Jeremy Lin&#39;,PLAYER!=&#39;Lorenzo Brown&#39;,
         PLAYER!=&#39;Malachi Richardson&#39;,PLAYER!=&#39;Marc Gasol&#39;,
         PLAYER!=&#39;Patrick McCaw&#39;,PLAYER!=&#39;Greg Monroe&#39;,
         PLAYER!=&#39;CJ Miles&#39;) %&gt;% 
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;% 
  mutate_if(sapply(.,is.character),as.factor) %&gt;% 
  select(-&#39;+/-&#39;) %&gt;% 
  gather(key,value,-TEAM,-MATCHUP,-DATE,-PLAYER,-win) %&gt;% # long to wide
  unite(col, key,PLAYER) %&gt;%
  spread(col,value) %&gt;% 
  select(-TEAM,-MATCHUP,-DATE) %&gt;%
  replace(is.na(.),0) %&gt;% 
  mutate_if(sapply(.,is.character),as.numeric)
ncol(players)</code></pre>
<pre><code>[1] 172</code></pre>
<pre class="r"><code>head(data.frame(players)[1:5])</code></pre>
<pre><code>  win X3PA_Danny.Green X3PA_Delon.Wright X3PA_Fred.VanVleet
1   W                2                 2                  2
2   L                6                 3                  6
3   W                3                 1                  8
4   W                8                 2                  6
5   W                0                 1                  4
6   W                3                 3                  5
  X3PA_Kawhi.Leonard
1                  3
2                  2
3                  3
4                  0
5                  6
6                  5</code></pre>
<pre class="r"><code>#tree &lt;- ctree(win~.,players,
#             controls = #ctree_control(mincriterion = 0.00001,minsplit=9))
#plot(tree)

treept &lt;- rpart(win~.,players,
                control = rpart.control(cp=0.0001,minsplit=6))

rpart.plot(treept, branch = 0.4)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>players %&gt;% 
  rename(&#39;TPP_Kyle_Lowry&#39;=&#39;TPP_Kyle Lowry&#39;,
         &#39;MIN_Pascal_Siakam&#39;=&#39;MIN_Pascal Siakam&#39;,
         &#39;MIN_Kawhi_Leonard&#39;=&#39;MIN_Kawhi Leonard&#39;) %&gt;% 
ggplot() +
  geom_point(aes(TPP_Kyle_Lowry,MIN_Pascal_Siakam,shape=win,col=win))+
  labs(x=&#39;3 point percent of Kyle Lowry&#39;,y=&#39;Minutes per game of Siakam&#39;)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-6-2.png" width="100%" style="display: block; margin: auto;" /></p>
<p>From the tree, Kyle Lowry’s 3 points accuracy is really important for win. It is surprise that Kawhi Leonard does not appear on the tree. It is opporiate to our common sense. It does not mean that Leonard is not significant, as a superstar, he really helps when pivotal time comes, and that contribution might not be reflected from models.</p>
<div id="playoffs" class="section level1">
<h1>Playoffs</h1>
<pre class="r"><code>playoffs &lt;- raptorsplayoffs %&gt;% 
  arrange(DATE) %&gt;% 
  na_if(&#39;-&#39;) %&gt;% 
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;% 
  mutate_if(sapply(.,is.character),as.factor) 

formula &lt;- win~PTS+FGM+FGA+FTM+FTA+OREB+DREB+REB+AST+STL+BLK+TOV+PF+FTP+TPP+FGP

tree &lt;- ctree(formula,playoffs,
              controls = ctree_control(mincriterion = 0.01,minsplit=3))

plot(tree)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>treept &lt;- rpart(formula,playoffs,
                control = rpart.control(cp=0.001,minsplit=3))
rpart.plot(treept, branch = 0.4)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-7-2.png" width="100%" style="display: block; margin: auto;" /></p>
<ul>
<li>Since the quantity of playoff data is too small, the results of the trees are unstable. Even discrepencies between the <code>rpart</code> and <code>ctree</code> function are huge. Now let us analyze the Regular Season data, which contains 82 games.</li>
</ul>
</div>
<div id="regular-season" class="section level1">
<h1>Regular Season</h1>
<ul>
<li>Now we begin to analyze raptors’ collective data.</li>
</ul>
<pre class="r"><code>regular&lt;- raptorsreg %&gt;% 
  arrange(DATE) %&gt;% 
  na_if(&#39;-&#39;) %&gt;% 
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;%
  mutate_if(sapply(.,is.character),as.factor)

corrplot(cor(regular %&gt;% 
               select(., PTS:PF), 
             use = &#39;complete.obs&#39;), 
         method = &#39;circle&#39;)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-8"></span>
<img src="/post/raptors.en_files/figure-html/unnamed-chunk-8-1.png" alt="Correlation Plot" width="100%" />
<p class="caption">
Figure 2: Correlation Plot
</p>
</div>
<pre class="r"><code>#tree &lt;- ctree(formula,regular,
#              controls = #ctree_control(mincriterion = 0.01,minsplit=3))
#plot(tree)
#plot(tree,type = &quot;simple&quot;)</code></pre>
<pre class="r"><code>treept &lt;- rpart(formula,regular,
                control = rpart.control(cp=0.05,minsplit=3))

rpart.plot(treept, branch = 0.4)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-9"></span>
<img src="/post/raptors.en_files/figure-html/unnamed-chunk-9-1.png" alt="When raptors score more than 111 and the field goals attempted more than 81, they will win in a high chance. If they get less than 111 points and shoot more than 82 times, they will definitely lose." width="100%" />
<p class="caption">
Figure 3: When raptors score more than 111 and the field goals attempted more than 81, they will win in a high chance. If they get less than 111 points and shoot more than 82 times, they will definitely lose.
</p>
</div>
<p>As you could see, the two trees are much same than before.</p>
<pre class="r"><code>ggplot(regular)+
  geom_point(aes(PTS,FGA,
                 shape=win,col=win)) +
  geom_segment(aes(111,81,
                   xend = 111,yend = 110),
               col=&#39;purple&#39;) +
  geom_segment(aes(111,81,
                   xend = 141,yend = 81),
               col=&#39;purple&#39;)+
  annotate(&#39;text&#39;, x =130,y=95, label=&#39;Win&#39;, size=10,color=&#39;turquoise4&#39;) +
  annotate(&#39;text&#39;, x =95,y=85, label=&#39;Lose&#39;, size=10,color=&#39;tomato&#39;) +
  labs(x=&#39;Points&#39;,y=&#39;Field Goals Attempted&#39;)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-10"></span>
<img src="/post/raptors.en_files/figure-html/unnamed-chunk-10-1.png" alt="Partition borders of the CART tree." width="100%" />
<p class="caption">
Figure 4: Partition borders of the CART tree.
</p>
</div>
<div id="combine-collective-data-and-players-personal-data" class="section level2">
<h2>Combine collective data and players’ personal data</h2>
<ul>
<li>Since I have not seen Leonard, I decide to combine personal data and collective data of whole team. Besides, since team’s points are too important and directly related to wining or not, I removed it.</li>
</ul>
<pre class="r"><code>players &lt;- regular_players %&gt;% 
  na_if(&#39;-&#39;) %&gt;%
  filter(PLAYER!=&#39;Jodie Meeks&#39;,PLAYER!= &#39;Eric Moreland&#39;,
         PLAYER!=&#39;Jonas Valanciunas&#39;,PLAYER!=&#39;Jordan Loyd&#39;,
         PLAYER!=&#39;Malcolm Miller&#39;,PLAYER!=&#39;Chris Boucher&#39;,
         PLAYER!=&#39;Jeremy Lin&#39;,PLAYER!=&#39;Lorenzo Brown&#39;,
         PLAYER!=&#39;Malachi Richardson&#39;,PLAYER!=&#39;Marc Gasol&#39;,
         PLAYER!=&#39;Patrick McCaw&#39;,PLAYER!=&#39;Greg Monroe&#39;,
         PLAYER!=&#39;CJ Miles&#39;) %&gt;% 
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;% 
  mutate_if(sapply(.,is.character),as.factor) %&gt;% 
  select(-&#39;+/-&#39;) %&gt;% 
  gather(key,value,-TEAM,-MATCHUP,-DATE,-PLAYER,-win) %&gt;% # wide to long
  unite(col,key,PLAYER) %&gt;%
  spread(col,value) %&gt;% # long to wide
  select(-TEAM,-MATCHUP) %&gt;%
  replace(is.na(.),0) %&gt;% 
  mutate_if(sapply(.,is.character),as.numeric)


intedt &lt;- left_join(regular,players, by =&#39;DATE&#39;, suffix = c(&#39;&#39;,&#39;.y&#39;)) %&gt;% 
  select(-PTS,-win.y,-TEAM,-DATE,-MATCHUP,-MIN,-&#39;+/-&#39;)

tree &lt;- rpart(win~.,intedt,
                control = rpart.control(cp=0.0001,minsplit=6))

rpart.plot(tree, branch = 0.4)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" />
PF: personal fouls</p>
<p>Now we could see Leonard appear on the tree. Except collective features(The total points has been deleted), Leonard and Siakam are players first appear on the tree, thus they are testified to be very important.</p>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>It is hard to draw a final conclusion because datasets are too small, and I have not found ways to handle missing values, which mean one player does not play at that game. Now I just filled them with 0. <code>party</code> and <code>rpart</code> always give me different results. Considering the length of passage, I do not display all results.</p>
</div>
