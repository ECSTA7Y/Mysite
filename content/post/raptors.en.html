---
title: '2018-2019 NBA Champion Toronto Raptors Analysis'
author: ''
date: '2019-10-30'
output:
  bookdown::html_document2:
    toc: true
    theme: readable
slug: raptors
---



<p><img src="https://img.shields.io/badge/License-CC%20BY--NC--ND%204.0-brightgreen.svg" /></p>
<p>Toronto Raptors won the 2018-2019 NBA Championship, which is really exciting. I watched the playoffs even months after the season was over. As a data analyst, I find <a href="https://stats.nba.com/">datas</a> of Raptors and did this analysis. Since tree methods could apperantly display the relations between the feature variables and the response variable, it is appropriate to use them to reveal the factors of wining.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="/img/vignette/raptors.jpg" alt="Kawhi Leonard versus KD, who was injured during G5" width="100%" />
<p class="caption">
Figure 1: Kawhi Leonard versus KD, who was injured during G5
</p>
</div>
<pre class="r"><code>library(readr)
library(dplyr)
library(tidyr)
library(reshape2)
library(magrittr)
library(party)
library(rpart)
library(rpart.plot)
library(ggplot2)</code></pre>
<pre class="r"><code>regular_players &lt;- regular_players %&gt;% 
  na_if(&#39;-&#39;) %&gt;%
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;% 
  mutate_if(sapply(.,is.character),as.factor) %&gt;% 
  select(-&#39;+/-&#39;)
#long to wide
library(tidyr)
players &lt;- regular_players %&gt;%
  gather(key,value,-TEAM,-MATCHUP,-DATE,-PLAYER,-win) %&gt;%
  unite(col, key,PLAYER) %&gt;%
  spread(col,value) %&gt;% 
  select(-TEAM,-MATCHUP,-DATE) %&gt;% 
  replace(is.na(.), 0) %&gt;% 
  mutate_if(sapply(.,is.character),as.numeric) </code></pre>
<pre class="r"><code>head(data.frame(players)[1:5])</code></pre>
<pre><code>  win X3PA_Chris.Boucher X3PA_CJ.Miles X3PA_Danny.Green X3PA_Delon.Wright
1   W                  0             0                2                 2
2   L                  2             1                6                 3
3   W                  0             0                3                 1
4   W                  1             0                8                 2
5   W                  0             0                0                 1
6   W                  1             2                3                 3</code></pre>
<pre class="r"><code>tree &lt;- ctree(win~.,players,
              controls = ctree_control(mincriterion = 0.00001,minsplit=9))
plot(tree)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>treept &lt;- rpart(win~.,players,
                control = rpart.control(cp=0.0001,minsplit=6))

rpart.plot(treept, branch = 0.4)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-6-2.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>players %&gt;% 
  rename(&#39;TPP_Kyle_Lowry&#39;=&#39;TPP_Kyle Lowry&#39;,
         &#39;MIN_Pascal_Siakam&#39;=&#39;MIN_Pascal Siakam&#39;) %&gt;% 
ggplot() +
  geom_point(aes(TPP_Kyle_Lowry,MIN_Pascal_Siakam,shape=win,col=win))</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-6-3.png" width="100%" style="display: block; margin: auto;" /></p>
<div id="playoffs" class="section level1">
<h1>Playoffs</h1>
<pre class="r"><code>playoffs &lt;- raptorsplayoffs %&gt;% 
  arrange(DATE) %&gt;% 
  na_if(&#39;-&#39;) %&gt;% 
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;% 
  mutate_if(sapply(.,is.character),as.factor) 

formula &lt;- win~PTS+FGM+FGA+FTM+FTA+OREB+DREB+REB+AST+STL+BLK+TOV+PF+FTP+TPP+FGP

tree &lt;- ctree(formula,playoffs,
              controls = ctree_control(mincriterion = 0.01,minsplit=3))

plot(tree)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>treept &lt;- rpart(formula,playoffs,
                control = rpart.control(cp=0.001,minsplit=3))
rpart.plot(treept, branch = 0.4)</code></pre>
<p><img src="/post/raptors.en_files/figure-html/unnamed-chunk-7-2.png" width="100%" style="display: block; margin: auto;" /></p>
<ul>
<li>Since the quantity of playoff data is too small, the results of the trees are unstable. Even discrepencies between the <code>rpart</code> and <code>ctree</code> function are huge. Now let us analyze the Regular Season data, which contains 82 games.</li>
</ul>
</div>
<div id="regular-season" class="section level1">
<h1>Regular Season</h1>
<pre class="r"><code>regular&lt;- raptorsreg %&gt;% 
  arrange(DATE) %&gt;% 
  na_if(&#39;-&#39;) %&gt;% 
  rename(&#39;TPP&#39;=&#39;3P%&#39;,&#39;FTP&#39;=&#39;FT%&#39;,
         &#39;FGP&#39;=&#39;FG%&#39;,&#39;win&#39;=&#39;W/L&#39;) %&gt;%
  mutate_if(sapply(.,is.character),as.factor)

tree &lt;- ctree(formula,regular,
              controls = ctree_control(mincriterion = 0.01,minsplit=3))
#plot(tree)
plot(tree,type = &quot;simple&quot;)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-8"></span>
<img src="/post/raptors.en_files/figure-html/unnamed-chunk-8-1.png" alt="The tree using `party` package." width="100%" />
<p class="caption">
Figure 2: The tree using <code>party</code> package.
</p>
</div>
<pre class="r"><code>treept &lt;- rpart(formula,regular,
                control = rpart.control(cp=0.05,minsplit=3))

rpart.plot(treept, branch = 0.4)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-9"></span>
<img src="/post/raptors.en_files/figure-html/unnamed-chunk-9-1.png" alt="When raptors score more than 111 and the field goals attempted more than 81, they will win in a high chance. If they get less than 111 points and shoot more than 82 times, they will definitely lose." width="100%" />
<p class="caption">
Figure 3: When raptors score more than 111 and the field goals attempted more than 81, they will win in a high chance. If they get less than 111 points and shoot more than 82 times, they will definitely lose.
</p>
</div>
<p>As you could see, the two trees are much same than before.</p>
<pre class="r"><code>ggplot(regular)+
  geom_point(aes(PTS,FGA,
                 shape=win,col=win)) +
  geom_segment(aes(111,81,
                   xend = 111,yend = 110),
               col=&#39;purple&#39;) +
  geom_segment(aes(111,81,
                   xend = 141,yend = 81),
               col=&#39;purple&#39;)+
  annotate(&#39;text&#39;, x =130,y=95, label=&#39;Win&#39;, size=10,color=&#39;turquoise4&#39;) +
  annotate(&#39;text&#39;, x =95,y=85, label=&#39;Lose&#39;, size=10,color=&#39;tomato&#39;) +
  labs(x=&#39;Points&#39;,y=&#39;Field Goals Attempted&#39;)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-10"></span>
<img src="/post/raptors.en_files/figure-html/unnamed-chunk-10-1.png" alt="Partition borders of the CART tree." width="100%" />
<p class="caption">
Figure 4: Partition borders of the CART tree.
</p>
</div>
</div>
