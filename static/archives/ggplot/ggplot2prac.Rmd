---
title: "ggplot2练习" 
author: ' '
date: '2019-06-27'
output:
  html_document:
slug: ggplot
---
<https://xsong.ltd/archives/ggplot/ggplot2prac>

[如何使用ggplot2?](https://mp.weixin.qq.com/s/mlfCRrd0CMzoYpuCSqsVtQ)

[用局部加权回归散点平滑法观察二维变量之间的关系](https://cosx.org/2008/11/lowess-to-explore-bivariate-correlation-by-yihui)

```{r a ,message = F,prompt=F, comment = NA,warning = F,message = F, include = T,fig.align='center',out.width ='100%',fig.asp=0.6}
library(ggplot2)
data(diamonds)
knitr::kable(head(diamonds),caption="数据概要",align='c')
#原始变量关系
ggplot(diamonds, aes(carat,price)) +
geom_bin2d() +
facet_wrap(~cut, nrow = 2)
#y变量取对数
ggplot(diamonds, aes(log(carat),price)) +
geom_point() +
facet_wrap(~cut, nrow = 2)
#x变量取对数
ggplot(diamonds, aes(carat,log(price))) +
geom_bin2d() +
facet_wrap(~cut, nrow = 2)
#都取对数，最终成为线性关系。
ggplot(diamonds, aes(log(carat), log10(price))) +
geom_bin2d(bins = 100) +
facet_wrap(~cut, nrow = 2)
```
```{r b ,message = F,prompt=F, comment = NA,warning = F,message = F, include = T,fig.align='center',out.width ='80%',fig.asp=0.6}
library(haven)
setwd("E:/R_codes/capplot")
X2010 <- read_dta("2010.dta")
xy <- read_dta("id.dta")
hho <- read_dta("aggregrate.dta")
nrow(hho)

set.seed(13)#设置随机数种子
sample <- sample(1:nrow(hho),600,replace = F)#抽取600个样本
hhosampled <- hho[sample,]#抽取
nrow(hhosampled)

library(ggplot2)
scattered <- ggplot(hho,aes(x=agem,y=inc,group=type,shape=type,color=type,weight=fswt_nat)) +
  ylim(0, 20000) +
  labs(title = " ",x = "年龄",y = "人民币(元）")+
  geom_smooth(span = 10,size=1.5) + 
  geom_point(data = hhosampled, alpha = 4/7,size = 2.5 )  +
  annotate("text", x = 70, y = 200, label="数据来源：CFPS,正常散点", size = 4) + #注解
  theme(legend.position = c(0.9,0.9))#图例位置
scattered

scattered2 <- ggplot(hho,aes(x=agem,y=inc,weight=fswt_nat)) +
  ylim(0, 20000) +
  labs(title = " ",x = "年龄",y = "人民币(元）")+
  geom_bin2d(bins = 70)  +
  geom_smooth(span = 10,size=1.5,colour='red') +
  annotate("text", x = 70, y = 200, label=" ", size = 4) + #注解
  theme(legend.position = c(0.9,0.9))#图例位置
scattered2



```



```{r c,message = F,prompt=F, comment = NA,warning = F,message = F, include = T,fig.align='center',out.width ='80%',fig.asp=0.6}
i <- ggplot(economics, aes(date, unemploy))
i + geom_area()

i + geom_line()




```

