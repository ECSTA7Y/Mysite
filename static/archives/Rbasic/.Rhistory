install.packages('psych')
library(psych)
data(USJudgeRatings)
USJudgeRatings
View(USJudgeRatings)
USJudgeRatings
head(USJudgeRatings)
knitr::kable(head(USJudgeRatings))
library(psych)
fa.parallel(USJudgeRatings[,-1], fa="pc", n.iter=100,
show.legend=FALSE, main="Scree plot with parallel analysis")
fa.parallel(USJudgeRatings[,-1], fa="pc", n.iter=100,
show.legend=FALSE, main="碎石图")
library(psych)
fa.parallel(USJudgeRatings[,-1], fa="pc", n.iter=100,
show.legend=F, main="碎石图")
pc <- principal(USJudgeRatings[,-1], nfactors=1, rotate="varimax", score=T) #方差极大旋转
pc
USJudgeRatings$score <- pc$scores
knitr::kable(head(USJudgeRatings$score))
View(USJudgeRatings)
library(haven)
V1_0718 <- read_sav("C:/Users/xsong/Desktop/V1-0718.sav")
View(V1_0718)
WWD <- read.csv("C:/Users/xsong/Desktop/WWD.csv")
View(WWD)
dt.car <- read.csv("C:/Users/xsong/Desktop/WWD.csv")
head(dt.car)
View(dt.car)
in the map
library(readxl)
mapdata <- read_excel("E:/R_codes/ggplot2map/geodata0131.xlsx")
View(mapdata)
library(reshape2)
long<- melt(china_data, id=c("long", "lat","group"))
rm(list=ls())
library(haven)
china_map_data <- read_dta("E:/R_codes/maps/nomissing/chnprovcd.dta")
library(plyr); library(dplyr)
# prepare work data, which needed to be filled in the map
library(readxl)
mapdata <- read_excel("E:/R_codes/ggplot2map/geodata0131.xlsx")
mapdata <- as.data.frame(mapdata)
mapdata <- select(mapdata,-(NAME)) #reverse selection
china_data <- join(china_map_data, mapdata, type="full")
china_data <- select(china_data,long,lat,group,out12,in12,out14,in14,out16,in16)
library(reshape2)
long<- melt(china_data, id=c("long", "lat","group"))
View(long)
long %>%
mutate(variable=ifelse(variable=='12out','2012土地流出',variable))
library(tidyverse)
long %>%
mutate(variable=ifelse(variable=='12out','2012土地流出',variable))
?within
library(tidyverse)
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27)
dt.car <- read.csv("C:/Users/xsong/Desktop/table/WWD.csv")
library(tidyverse)
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27)
View(dta)
View(dt.car)
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27) %>% #筛选列
rename(age=S6__1__open,)#重命名
View(dta)
dta <- within(dta,{
eduy <- NA
eduy[edu=='初中'] <- 9
eduy[edu=='大学本科 - 国内'| edu=='大学本科 - 国外'] <- 16
eduy[edu=='大专'] <- 15
eduy[edu=='高中'] <- 12
eduy[edu=='技术/职业学校/中专'] <- 12
eduy[edu=='研究生或以上 - 国内'] <- 20
})
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27) %>% #筛选列
rename(age=S6__1__open,edu=D3)#重命名
#
dta <- within(dta,{
eduy <- NA
eduy[edu=='初中'] <- 9
eduy[edu=='大学本科 - 国内'| edu=='大学本科 - 国外'] <- 16
eduy[edu=='大专'] <- 15
eduy[edu=='高中'] <- 12
eduy[edu=='技术/职业学校/中专'] <- 12
eduy[edu=='研究生或以上 - 国内'] <- 20
})
dta <- dta %>%
select(edu,eduy,everything())
library(dplyr)
?recode
dt.car <- read.csv("C:/Users/xsong/Desktop/table/WWD.csv")
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27) %>% #筛选列
rename(age=S6__1__open,edu=D3) %>%#重命名
mutate(eduy=recode(edu,'初中'=9,'大学本科 - 国内'=16,'大专'=15,'高中'=12,'研究生或以上 - 国内'=20))
#
dta <- dta %>%
select(edu,eduy,everything())
dt.car <- read.csv("C:/Users/xsong/Desktop/table/WWD.csv")
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27) %>% #筛选列
rename(age=S6__1__open,edu=D3) %>%#重命名
mutate(eduy=fct_recode(edu,'初中'=9,'大学本科 - 国内'=16,'大专'=15,'高中'=12,'研究生或以上 - 国内'=20))
dt.car <- read.csv("C:/Users/xsong/Desktop/table/WWD.csv")
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27) %>% #筛选列
rename(age=S6__1__open,edu=D3) %>%#重命名
mutate(eduy=recode(edu,'初中'=9,'大学本科 - 国内'=16,'大学本科 - 国外'=16,'大专'=15,'高中'=12,'技术/职业学校/中专'=12,'研究生或以上 - 国内'=20))
dta <- dta %>%
select(edu,eduy,everything())
dta[Q7__1:Q7__35]
dta[Q7__1]
dta[Q7_1]
library(tidyverse)
dt.car <- read.csv("C:/Users/xsong/Desktop/table/WWD.csv")
dta <- dt.car %>%
select(S5,S6__1__open,D5,D6,D3,S10B,Q7__1:Q7__35,A0__1:A0__27) %>% #筛选列
rename(age=S6__1__open,edu=D3) %>% #重命名
mutate(eduy=recode(edu,'初中'=9,
'大学本科 - 国内'=16,
'大学本科 - 国外'=16,
'大专'=15,
'高中'=12,
'技术/职业学校/中专'=12,
'研究生或以上 - 国内'=20)) %>% #重编码
select(edu,eduy,everything()) #
dta[Q7__1]
dta[,Q7__1:Q7__35]
dta[,c(Q7__1:Q7__35)]
?lapply
lapply(pcdata,mean)
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
lapply(pcdata,mean)
?aggregate
?lapply
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) pcdata <- within(pcdata,{
pcdata[pcdata[,i]=='非常同意'] <- 1
pcdata[pcdata[,i]=='比较同意'] <- 2
pcdata[pcdata[,i]=='谈不上同不同意'] <- 3
pcdata[pcdata[,i]=='比较不同意'] <- 4
pcdata[pcdata[,i]=='完全不同意'] <- 5
})
for(i in 1:ncol(pcdata)) pcdata <- within(pcdata,{
pcdata[pcdata[,i]=='非常同意1'] <- 1
pcdata[pcdata[,i]=='比较同意2'] <- 2
pcdata[pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[pcdata[,i]=='比较不同意4'] <- 4
pcdata[pcdata[,i]=='完全不同意5'] <- 5
})
View(pcdata)
for(i in 1:ncol(pcdata)){pcdata <- within(pcdata,{
pcdata[pcdata[,i]=='非常同意1'] <- 1
pcdata[pcdata[,i]=='比较同意2'] <- 2
pcdata[pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[pcdata[,i]=='比较不同意4'] <- 4
pcdata[pcdata[,i]=='完全不同意5'] <- 5
})}
for(i in 1:ncol(pcdata)) pcdata <- within(pcdata,{
pcdata[,i][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i][pcdata[,i]=='完全不同意5'] <- 5
})
pcdata <- within(pcdata,{
pcdata[,1][pcdata[,1]=='非常同意1'] <- 1
})
for(i in 1:ncol(pcdata)) pcdata[,i][pcdata[,i]=='非常同意1'] <- 1
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) pcdata[,i][pcdata[,i]=='非常同意1'] <- 1
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata))
pcdata[,i][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata))
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata))
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
}
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) {
pcdata[,i][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i][pcdata[,i]=='谈不上同不同意3'] <- 3
}
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i+35][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i+35][pcdata[,i]=='完全不同意5'] <- 5
}
pcdata <- dta %>% #ctrl+shift+m
select(-(Q7__1:Q7__35))
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i+35][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i+35][pcdata[,i]=='完全不同意5'] <- 5
}
pcdata <- pcdata %>% #ctrl+shift+m
select(-(Q7__1:Q7__35))
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:ncol(pcdata)) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i+35][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i+35][pcdata[,i]=='完全不同意5'] <- 5
}
pcdata <- pcdata %>% #ctrl+shift+m
select(-(Q7__1:Q7__35))
pcdata <- dta %>% #ctrl+shift+m
select(Q7__1:Q7__35)
for(i in 1:35) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i+35][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i+35][pcdata[,i]=='完全不同意5'] <- 5
}
pcdata <- pcdata %>% #ctrl+shift+m
select(-(Q7__1:Q7__35))
ncol(pcdata)
library(tidyverse)
dt.car <- read.csv("C:/Users/xsong/Desktop/table/DT.csv")
knitr::kable(table(dt.car$S5))
knitr::kable(table(dt.car$D5))
knitr::kable(table(dt.car$D3))
knitr::kable(table(dt.car$S10B))
knitr::kable(table(dt.car$S10))
#ggplot(dt.car, aes(x = S6__1__open,fill=S10B)) + geom_histogram(density = 70) +
#xlab('年龄') +
#ylab('频数') +
#labs(fill="车型")
#ggplot(dt.car, aes(S10B,S6__1__open)) +
#  geom_boxplot(size=0.1,outlier.colour ='sky blue',fill='sky blue') +
#xlab('车型') +
#ylab('年龄')
#thme(fill=guide_legend(title='车型'))
dt.car$S10B <- as.character(dt.car$S10B)
#dt.car$S3 <- as.numeric(dt.car$S3)
dta <- dt.car %>%
select(S5,S3,S6__1__open,D5,D6,D3,S10,S10B,Q7__1:Q7__35,A0__1:A0__27,) %>% #筛选列
rename(age=S6__1__open,edu=D3) %>% #重命名      唐山
mutate(cityle=recode(S3,'成都'='一线','上海'='一线','广州'='一线','南京' ='二线','惠州'='二线', '郑州' ='二线','唐山'='三线', '常州'='三线', '临沂'='三线','北京'='一线城市'),
cityregion=recode(S3,'成都'='西南','上海'='东部','广州'='南部','南京'='东部','惠州'='南部','郑州' ='中部','唐山'='北部', '常州'='东部','临沂'='北部','北京'='北部'),
eduy=recode(edu,'初中'=9,
'大学本科 - 国内'=16,
'大学本科 - 国外'=16,
'大专'=15,
'高中'=12,
'技术/职业学校/中专'=12,
'研究生或以上 - 国内'=20),
edu_stage = recode(edu,'初中'='初中及以下',
'大学本科 - 国内'='大专及以上',
'大学本科 - 国外'='大专及以上',
'大专'='大专及以上',
'高中'='高中或中专',
'技术/职业学校/中专'='高中或中专',
'研究生或以上 - 国内'='大专及以上'),
age_stage = '30岁以下',
age_stage = ifelse(age>30 & age<=40,'30-40岁',age_stage),
age_stage = ifelse(age>40,'40岁以上',age_stage),
child=recode(D6,'有1个孩子'='有孩子',
'有2个孩子'='有孩子',
'有3个孩子及以上'='有孩子',
'没有孩子'='没有孩子',
.default='没有结婚'),
S10=recode(S10,'奥迪-A4L'='豪华车',
'宝马-320Li'='豪华车',
'奔驰-C180'='豪华车'),
S10B = ifelse(S10 =='豪华车','豪华车',S10B)) %>% #重编码
select(edu,eduy,cityle,everything()) #排序
pcdata <- dta %>% #用于主成分分析的数据
select(Q7__1:Q7__35)
#循环编码35个变量
for(i in 1:35) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i+35][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i+35][pcdata[,i]=='完全不同意5'] <- 5
}
pcdata <- pcdata %>% #保留需要主成分分析的35个变量
select(-(Q7__1:Q7__35))
#主成分分析
library(psych)
fa.parallel(pcdata, fa="pc", n.iter=100,show.legend=F, main="碎石图")
pc <- principal(pcdata, nfactors=3, rotate="varimax", score=T) #方差极大旋转
pc #三个主成分为PC1,PC2, PC3
rmd <- pc$scores #2个主成分为RC1,RC2
rmd <- as.data.frame(rmd)
rmd <- rmd %>%
rename(lfatd1=RC1,lfatd2=RC2,lfatd3=RC3)
dta <- cbind(dta,rmd)
pcdata2 <- dta %>% #用于主成分分析的数据
select(A0__1:A0__27)
#循环编码27个变量
for(i in 1:27) {
pcdata2[,i+27] <- 0
pcdata2[,i+27][pcdata2[,i]=='非常同意1'] <- 1
pcdata2[,i+27][pcdata2[,i]=='比较同意2'] <- 2
pcdata2[,i+27][pcdata2[,i]=='谈不上同意不同意3'] <- 3
pcdata2[,i+27][pcdata2[,i]=='比较不同意4'] <- 4
pcdata2[,i+27][pcdata2[,i]=='完全不同意5'] <- 5
}
pcdata2 <- pcdata2 %>% #保留需要主成分分析的27个变量
select(-(A0__1:A0__27))
#主成分分析
library(psych)
fa.parallel(pcdata2, fa="pc", n.iter=100,show.legend=F, main="碎石图")
pc2 <- principal(pcdata2, nfactors=3, rotate="varimax", score=T) #方差极大旋转
pc2
cwb <- pc2$scores #2个主成分为RC1,RC2
cwb <- as.data.frame(cwb)
cwb <- cwb %>%
rename(catatd1=RC1,catatd2=RC2,catatd3=RC3)
dta <- cbind(dta,cwb)
#dta <- dta %>%
#  select(-(edu),-(D6),-(Q7__1:Q7__35),-(A0__1:A0__27),)
#knitr::kable(head(dta,n=10),caption = '数据概要')
cludta <- dta %>%
select(lfatd1,lfatd2,lfatd3,catatd1,catatd2,catatd3)
library(cluster)
dta.scaled <- scale(cludta) #变量中心化
d <- dist(dta.scaled) #计算欧式距离
fit <- hclust(d, method="ward.D")
plot(fit, hang=-1, cex=.8, main="层次聚类图(使用Ward方法)",xlab='样本',ylab='高度')
rect.hclust(fit, k=4, border = "red")
#dta$clusters <- cutree(fit, k=4)
pcdata <- dta %>% #用于主成分分析的数据
select(Q7__1:Q7__35)
#循环编码35个变量
for(i in 1:35) {
pcdata[,i+35] <- 0
pcdata[,i+35][pcdata[,i]=='非常同意1'] <- 1
pcdata[,i+35][pcdata[,i]=='比较同意2'] <- 2
pcdata[,i+35][pcdata[,i]=='谈不上同不同意3'] <- 3
pcdata[,i+35][pcdata[,i]=='比较不同意4'] <- 4
pcdata[,i+35][pcdata[,i]=='完全不同意5'] <- 5
}
pcdata <- pcdata %>% #保留需要主成分分析的35个变量
select(-(Q7__1:Q7__35))
#主成分分析
library(psych)
fa.parallel(pcdata, fa="pc", n.iter=100,show.legend=F, main="碎石图")
pc <- principal(pcdata, nfactors=3, rotate="varimax", score=T) #方差极大旋转
pc #三个主成分为PC1,PC2, PC3
rmd <- pc$scores #2个主成分为RC1,RC2
rmd <- as.data.frame(rmd)
rmd <- rmd %>%
rename(lfatd1=RC1,lfatd2=RC2,lfatd3=RC3)
dta <- cbind(dta,rmd)
pcdata2 <- dta %>% #用于主成分分析的数据
select(A0__1:A0__27)
