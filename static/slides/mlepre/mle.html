<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>多层线性模型</title>
    <meta charset="utf-8" />
    <meta name="author" content="宋骁 彭璟 吴迪雅 姜昱竹 宋虹玉" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="zh-CN.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# 多层线性模型
## 高级定量分析
### 宋骁 彭璟 吴迪雅 姜昱竹 宋虹玉
### 2019/06/17

---

# Let's Start!
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1559987331910&amp;di=a089e476c808440db9f7a356b7096f51&amp;imgtype=0&amp;src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-ea8103bf18ea17c1320dfceadf9f580f_b.gif" alt=" " width="55%" /&gt;
&lt;p class="caption"&gt; &lt;/p&gt;
&lt;/div&gt;

---
class: center, middle
# 数据与变量
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="zhu.jpg" alt="姜昱竹 10171170149" width="55%" /&gt;
&lt;p class="caption"&gt;姜昱竹 10171170149&lt;/p&gt;
&lt;/div&gt;
---

## 数据介绍
.mid[
+ 1988 年**中国居民收入调查**(CHIP)数据

+ 由中国社会科学院经济研究所主持。

+ 分阶段抽样：

  + 先从30 个省级行政单位中抽选出10 个省份。
  
  + 再从这10个省份的434个城市中抽选出55个城市。
  
  + 在55个城市中，共调查9009 户家庭。


+ 调查问卷收集了每一户中所有家庭成员的资料。在删除缺失数据和不完整观测个案之后，总共得到15862条居民个体的观测数据。
]
---

## 研究问题
.large[
+ 研究经济改革的成功与个人收入决定因素之间的关系
]
---

## 变量
.mid[
+ 因变量：
  + 收入的自然对数值

+ 个人变量：
  + &lt;font color=#FF0000&gt;教育年限&lt;/font&gt;
  + 工作年限(即工龄)
  + 党员身份的虚拟变量(1=党员, 0=非党员)
  + 性别的虚拟变量(1=女性, 0=男性)

+ 城市层面变量：
  + 1985年和1988年之间各城市工业总产值(GPVI)的变化
  
`$${Z_j} = \log (GPV{I_{1988}}/GPV{I_{1985}})$$`
]
---
## 因变量

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="mle_files/figure-html/512-1.png" alt="标准化总成绩的密度直方图" width="75%" /&gt;
&lt;p class="caption"&gt;标准化总成绩的密度直方图&lt;/p&gt;
&lt;/div&gt;


---
class: center, middle

# 模 型

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="diya.jpg" alt="吴迪雅10161170121" width="35%" /&gt;
&lt;p class="caption"&gt;吴迪雅10161170121&lt;/p&gt;
&lt;/div&gt;

---


## 零模型(ANOVA)
.mid[
 + 层1： 
 
`$${y_{ij}} = {\beta _{0j}} + {\varepsilon _{ij}}$$`
 + 层2：
 
`$${\beta _{0j}} = {\gamma _{00}} + {\mu _{0j}}$$`
 + 组合模型
 
`$${y_{ij}} = {\gamma _{00}} + {\mu _{0j}} + {\varepsilon _{ij}}$$`

其中,
`\({\beta _{0j}}\)`是第j个层2单位的平均值,

`\(\gamma_{00}\)`表示样本整体中因变量的总平均值(grand mean) ,

`\({\mu _{0j}}\)`是与第j个层2单位相联系的随机效应
]
---
## 随机截距模型
.mid[
+ 层1：

`$${{\rm{y}}_{ij}} = {\beta _{0j}} + {\beta _{1j}}({x_{ij}} - {{\bar x}_{ \cdot j}}) + {\varepsilon _{ij}}$$`



+ 层2：

`$${\beta _{0j}} = {\gamma _{00}} + {\mu _{0j}}$$`

+ 组合模型

`$${{\rm{y}}_{ij}} = \underbrace {{\beta _{1j}}({x_{ij}} - {{\bar x}_{ \cdot j}})}_{fixed{\rm{ }}\ effect} + \underbrace {{\gamma _{00}} + {\mu _{0j}} + {\varepsilon _{ij}}}_{random{\rm{ }}\ effect}$$`

其中,
`\(\gamma_{00}\)`表示层2 所有单位的回归截距的平均值。

`\(\gamma_{10}\)`表示层2 所有单位的回归斜率的平均值。
]
---
## 随机截距模型

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="random.jpg" alt=" " width="70%" /&gt;
&lt;p class="caption"&gt; &lt;/p&gt;
&lt;/div&gt;



---

## 随机系数模型
.mid[
+ 层1：

`$${{\rm{y}}_{ij}} = {\beta _{0j}} + {\beta _{1j}}({x_{ij}} - {{\bar x}_{ \cdot j}}) + {\varepsilon _{ij}}$$`

+ 层2：

`$${\beta _{0j}} = {\gamma _{00}} + {\mu _{0j}}$$`
`$${\beta _{1j}} = {\gamma _{10}} + {\mu _{1j}}$$`

组合模型：
`$${{\rm{y}}_{ij}} = \underbrace {{\gamma _{00}} + {\gamma _{10}}({x_{ij}} - {{\bar x}_{ \cdot j}})}_{fixed{\rm{ }}\ effect} + \underbrace {{\mu _{0j}} + {\mu _{1j}}({x_{ij}} - {{\bar x}_{ \cdot j}}) + {\varepsilon _{ij}}}_{random{\rm{ }}\ effect}$$`


]



---
## 随机系数模型

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="random2.jpg" alt=" " width="70%" /&gt;
&lt;p class="caption"&gt; &lt;/p&gt;
&lt;/div&gt;


---
### 完全模型(引入层2解释变量)

#### 将截距和斜率作为结果的回归模型

 + 层1： 
 
`$${y_{ij}} = {\beta _{0j}} + {\beta _{1j}}{x_{ij}} + {\varepsilon _{ij}}$$`
 + 层2：
 
`$${\beta _{0j}} = {\gamma _{00}} + {\gamma _{01}}{Z_j} + {\mu _{0j}}$$`

`$${\beta _{1j}} = {\gamma _{10}} + {\gamma _{11}}{Z_j} + {\mu _{1j}}$$`

+ 代入得到：

`$${y_{ij}} = \underbrace {{\gamma _{00}} + {\gamma _{01}}{Z_j} + {\gamma _{10}}{x_{ij}} + {\gamma _{11}}{Z_j}{x_{ij}}}_{fixed{\rm{ }}\ effect} + \underbrace {{\mu _{0j}} + {\mu _{1j}}{x_{ij}} + {\varepsilon _{ij}}}_{random{\rm{ }}\ effect}$$`

`\({Z_j}\)`
为层2解释变量，为第j个城市的工业总产值(GPVI)的变化

---
class: center, middle

# Stata 命令
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="xsong.jpg" alt="宋骁 10161170106" width="35%" /&gt;
&lt;p class="caption"&gt;宋骁 10161170106&lt;/p&gt;
&lt;/div&gt;
---
## 命令示例

+ **geo**为层2标识变量  

+ **z**为层2解释变量。1985年和1988年之间各城市工业总产值(GPVI)的变化，&lt;font color=#FF0000&gt; **z**越大，则该城市经济发展越快&lt;/font&gt; 。

```sql

/*零模型*/
mixed LogY || geo: , variance

/*随机截距模型*/
mixed LogY x1 || geo: , variance

/*随机系数模型*/
mixed LogY x1 || geo: x1, variance

/*完全模型*/
mixed LogY x1 z x1#z || geo: x1, variance


```
---
## 对中

```sql
/*组均值对中*/
sort geo

*by geo: egen edumean = mean(edu) 

g cen_edu = edu - edumean

```
---

## 零模型运行结果

```python 
*. mixed logearn || geo: , variance

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log likelihood = -7978.9487  
Iteration 1:   log likelihood = -7978.9487  (backed up)

Computing standard errors:

*Mixed-effects ML regression                     Number of obs     =     15,862
*Group variable: geo                             Number of groups  =         55

                                                Obs per group:
                                                              min =         80
                                                              avg =      288.4
                                                              max =      1,096

                                                Wald chi2(0)      =          .
Log likelihood = -7978.9487                     Prob &gt; chi2       =          .

```

---

```python 



------------------------------------------------------------------------------
     logearn |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
*      _cons |   7.421528   .0254612   291.48   0.000     7.371625     7.47143
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
geo: Identity                |
*                 var(_cons) |   .0348887   .0068122      .0237949    .0511547
-----------------------------+------------------------------------------------
               var(Residual) |   .1579178   .0017763      .1544744     .161438
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 2377.51       Prob &gt;= chibar2 = 0.0000

```
---
## 随机截距模型

```sql
*. mixed logearn cen_edu || geo: , variance

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log likelihood = -7838.2144  
Iteration 1:   log likelihood = -7838.2144  

Computing standard errors:

Mixed-effects ML regression                     Number of obs     =     15,862
Group variable: geo                             Number of groups  =         55

                                                Obs per group:
                                                              min =         80
                                                              avg =      288.4
                                                              max =      1,096

                                                Wald chi2(1)      =     283.99
Log likelihood = -7838.2144                     Prob &gt; chi2       =     0.0000

```
---

```sql
------------------------------------------------------------------------------
     logearn |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
*    cen_edu |   .0172395    .001023    16.85   0.000     .0152345    .0192446
*      _cons |   7.421519   .0254621   291.47   0.000     7.371614    7.471424
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
geo: Identity                |
*                 var(_cons) |   .0349047   .0068124      .0238096    .0511699
-----------------------------+------------------------------------------------
               var(Residual) |   .1551307    .001745       .151748    .1585888
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 2420.35       Prob &gt;= chibar2 = 0.0000


```
---
## 随机系数模型

```sql
*. mixed logearn cen_edu || geo: cen_edu, variance

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log likelihood = -7823.6964  
Iteration 1:   log likelihood = -7823.6964  

Computing standard errors:

Mixed-effects ML regression                     Number of obs     =     15,862
Group variable: geo                             Number of groups  =         55

                                                Obs per group:
                                                              min =         80
                                                              avg =      288.4
                                                              max =      1,096

                                                Wald chi2(1)      =     106.60
Log likelihood = -7823.6964                     Prob &gt; chi2       =     0.0000

```
---
```sql
------------------------------------------------------------------------------
     logearn |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
*    cen_edu |    .016245   .0015734    10.32   0.000     .0131612    .0193288
       _cons |   7.421517   .0254624   291.47   0.000     7.371612    7.471422
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
geo: Independent             |
*               var(cen_edu) |   .0000667   .0000246      .0000323    .0001376
                  var(_cons) |   .0349087   .0068126      .0238133     .051174
-----------------------------+------------------------------------------------
               var(Residual) |   .1544599   .0017402      .1510866    .1579085
------------------------------------------------------------------------------
LR test vs. linear model: chi2(2) = 2449.38               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.

```
---
## 完全模型

```sql
*. mixed logearn cen_edu exp cpc sex gross_d c.cen_edu#c.gross_d || geo:exp cpc sex cen_
&gt; edu, variance

Mixed-effects ML regression                     Number of obs     =     15,862
Group variable: geo                             Number of groups  =         55

                                                Obs per group:
                                                              min =         80
                                                              avg =      288.4
                                                              max =      1,096

                                                Wald chi2(6)      =    2628.79
Log likelihood = -5403.8032                     Prob &gt; chi2       =     0.0000

```
---

## 完全模型：固定系数部分

```sql

-------------------------------------------------------------------------------------
            logearn |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
--------------------+----------------------------------------------------------------
*           cen_edu |   .0380013   .0032783    11.59   0.000     .0315759    .0444268
                exp |   .0174375   .0004236    41.17   0.000     .0166074    .0182677
                cpc |   .0822814   .0081615    10.08   0.000     .0662852    .0982776
                sex |  -.1015378   .0097093   -10.46   0.000    -.1205677    -.082508
*           gross_d |   .4608808   .1000528     4.61   0.000      .264781    .6569806
                    |
*c.cen_edu#c.gross_d |  -.0121546   .0064393    -1.89   0.059    -.0247754    .0004662
                    |
              _cons |   6.887406   .0521607   132.04   0.000     6.785173    6.989639
-------------------------------------------------------------------------------------
```
---
## 完全模型：随机系数部分

```python
------------------------------------------------------------------------------
  Random-effects Parameters  |   Estimate   Std. Err.     [95% Conf. Interval]
-----------------------------+------------------------------------------------
geo: Independent             |
                    var(exp) |   3.89e-06   1.54e-06      1.79e-06    8.45e-06
                    var(cpc) |   .0005872   .0005456       .000095    .0036279
                    var(sex) |   .0030459   .0008939      .0017135    .0054142
*               var(cen_edu) |   .0000554   .0000194      .0000279    .0001099
                  var(_cons) |   .0255124   .0052168      .0170882    .0380897
-----------------------------+------------------------------------------------
               var(Residual) |   .1130884   .0012793      .1106086    .1156238
------------------------------------------------------------------------------
LR test vs. linear model: chi2(5) = 2591.96               Prob &gt; chi2 = 0.0000

Note: LR test is conservative and provided only for reference.


```


---
## 结论
.large[
+ 改革开放时期中国的地区异质性会影响中国的人力资本回报率。

+ 交互项系数为负。经济发展水平越高的地区，教育回报率越低。
]


---
class: center, middle

# 谢谢!
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1559921618412&amp;di=f118b115bf4ab9ab74be09f366906204&amp;imgtype=0&amp;src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201809%2F12%2F20180912072220_qivjj.thumb.700_0.gif" alt=" " width="60%" /&gt;
&lt;p class="caption"&gt; &lt;/p&gt;
&lt;/div&gt;

---
class: center, middle
# 幻灯片制作
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="penjin.jpg" alt="彭璟 10171170121" width="30%" /&gt;
&lt;p class="caption"&gt;彭璟 10171170121&lt;/p&gt;
&lt;/div&gt;
---
class: center, middle
# 数据清理
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="songhongyu.jpg" alt="宋虹玉 10171170131" width="40%" /&gt;
&lt;p class="caption"&gt;宋虹玉 10171170131&lt;/p&gt;
&lt;/div&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
